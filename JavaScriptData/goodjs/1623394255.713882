YUI.add("af-applet-view",function(e,t){"use strict";var i=e.Af.Utils.perfStart,n=e.Af.Utils.perfStop,s=e.Af.Bootstrap,r=e.Lang.isFunction,a="error",d="viewrender",h="viewupdate";e.namespace("Af").AppletView=e.Base.create("AfAppletView",e.View,[],{isDirty:!1,tmplPrefix:"ape-applet-templates-",_handles:[],autoRender:!0,isEditView:!1,initializer:function(t){this._handles.push(this.after("displayChange",function(e){this.fireEvent("viewdisplay",{prevRegion:e.prevVal,newRegion:e.newVal})},this)),this._handles.push(this.after("viewrender",function(){var t=this;e.use("stencil",function(e){e.Stencil.initAll(t.get("container"))})},this)),e.each(["autoRender"],function(i){e.Object.owns(t,i)&&(this[i]=t[i])},this),this.autoRender&&(this._dataHandle=this.get("model").after("dataChange",function(){this.isDirty=!0,this.render()},this))},destructor:function(){this._dataHandle&&(this._dataHandle.detach(),delete this._dataHandle),this.get("container").destroy(!0),e.Array.each(this._handles,function(e){e.detach()}),delete this.tmplPrefix,delete this.isDirty,delete this._handles},getTemplate:function(){if(this._template)return this._template;var e=this.get("name"),t=s.getTemplateName(this.get("guid"),e);return dust.cache[t]?(this._template=t,t):(t=this.tmplPrefix+e,dust.cache[t]?(this._template=t,t):null)},loadLazyTemplates:function(t){r(t)||(t=null);var i=s.getLazyLoadYuiModules(this.get("guid"),"templates"),n=e.Array.filter(i,function(e){return!dust.cache[e]});0!==n.length?e.use(n,function(){if(t){var i=e.Array.filter(n,function(e){return!dust.cache[e]});i&&i.length>0?t(i):t()}}):t&&t()},refresh:function(){throw"refresh() not implemented"},setHTML:function(t){return e.Af.Dom.setHTML(this.get("container"),t),this},shouldRender:function(){return this.isDirty||!this.hasContent()},render:function(){return this.shouldRender()&&this.loadLazyTemplates(e.bind(this._render,this)),this},_render:function(){var t,s,r,h=this.getTemplate();return h?(r=this.get("type")+":"+this.get("name")+":",i(s=r+"tojson"),t=this.get("model").toJSON(),n(s),i(s=r+"dust"),dust.render(h,t,e.bind(function(e,t){n(s),e?this.fireEvent(a,{code:d,message:e.message||e}):(this.setHTML(t),this.isDirty=!1,this.fireEvent(d))},this)),this):(this.fireEvent(a,{code:d,message:"no template found"}),this)},forceRender:function(){return this.isDirty=!0,this.render()},update:function(t,i,n,s,r){"function"==typeof(s=s||{})&&(r=s,s={});var d,u,o=this.get("container"),l=this.get("model");return t="string"==typeof t?o.one(t):t,i&&dust.cache[i]?n?t||(d="can't find node"):d="missing data":d="missing template:"+i,d?(this.fireEvent(a,{code:h,message:d}),r&&window.setTimeout(function(){r(d)},0),this):(u=e.merge(n,{i18n:l.get("i18n"),intl:l.get("intl")}),dust.render(i,u,e.bind(function(i,n){return i?(this.fireEvent(a,{code:h,message:i.message||i}),r&&r(i)):("append"===s.mode?t.append(n):e.Af.Dom.setHTML(t,n),o.contains(t)&&this.fireEvent(h),r&&r(null,n))},this)),this)},hasContent:function(){var t=this.get("container");return""!==e.Lang.trim(t.getHTML())},fireEvent:function(e,t){var i={applet:{guid:this.get("guid"),type:this.get("type"),view:{name:this.get("name")}}};i[e]=t||{},this.fire(e,i)},getRapid:function(){var t=e.Af.rapid;return(t&&r(t.getRapidTracker)?t.getRapidTracker():e.rapid)||null},rapidBeaconClick:function(t,i){var n=e.Af.rapid;t&&n&&r(n.triggerBeaconClickEvent)&&n.triggerBeaconClickEvent(t,i)},rapidParseYLK:function(t){var i=e.Af.rapid;if(t&&i&&r(i.parseYLK))return i.parseYLK(t)},rapidGetSec:function(t){var i=e.Af.rapid;if(t&&i&&r(i.getSecValue))return i.getSecValue(t)}},{ATTRS:{guid:{},type:{},name:{},model:{},display:{value:null}}})},"@VERSION@",{requires:["af-bootstrap","af-utils","base-build","dust","view"]});
define(["local/common/components/nsglibCommon","local/"+window.nsglibCommon.ress.getRessVersion()+"/phx/layer"],function(e,t){var n,o,i,r=document.location.pathname,a=document.location.search,d=document.location.href;return{close:p,init:function(){h(),e.headData.save(),e.domBuilder.addEvent(document.body,"click",s),e.domBuilder.addEvent(document.body,"click",u),e.domBuilder.addEvent(window,"popstate",f)}};function s(t){if(!("undefined"!=typeof offline&&!0===offline||"undefined"!=typeof accStaticr&&void 0!==accStaticr.offline&&!0===accStaticr.offline||t.ctrlKey||t.shiftKey||t.metaKey||t.button&&1==t.button)){var n=t.target.closest("a");if(n&&n.href&&n.getAttribute("data-phx-url")){if(0==+n.getAttribute("data-phx-url"))return i=n.href,void requestAnimationFrame(l);void 0!==window.dlApi&&(window.interstitialAds&&window.interstitialAds.isActive?(t.preventDefault(),window.interstitialAds.callback({destinationUrl:n.href,eventTarget:n,event:t,callback:r})):r())}}function r(){window.interstitialAds={};var i=document.querySelector(".pageHeader");e.domBuilder.addClass(i,"phxOpening"),e.domBuilder.hasClass(document.body,"pageHeaderSmall")||e.domBuilder.removeClass(i,"switch"),setTimeout(function(){e.domBuilder.removeClass(i,"phxOpening")},500);var r=n.getAttribute("data-art-type"),a=new URL(n.href);a.hash="",o={domElement:n,rect:n.getBoundingClientRect()},history.pushState({phxURL:a.href,detailType:r},void 0,a.href),m(a.href),t.preventDefault()}}function l(){window.nsglibCommon.phxAdsConfigurator.saveOriginalAdsConfiguration(),window.nsglibCommon.phxAdsConfigurator.destroyMainPageSlots(),localStorage.setItem("sg.externalOpen.url",i),e.domBuilder.addEvent(window,"focus",c)}function c(){e.gemius.hit(),window.nsglibCommon.phxAdsConfigurator.restoreMainPageAdsConfiguration("nonInstantBack",window.location.href),window.nsglibCommon.phxAdsConfigurator.restoreMainPageSlots(),localStorage.removeItem("sg.externalOpen.url"),e.domBuilder.removeEvent(window,"focus",c)}function u(e){"close"===e.target.getAttribute("data-action-phx")&&p(!1,e.target.getAttribute("data-phx-close-type")||"unknown")}function f(e){var t=e.state||{};window.nsglibCommon.phxLayer.layerIsStatic()&&location.href.indexOf("#")<0?window.open(t.phxURL||"/","_self"):t.phxURL?m(t.phxURL,t.detailType):window.nsglibCommon.phxLayer.layerIsOpened()&&location.href.indexOf("#")<0&&p(!0,"back")}function p(n,i){if(window.nsglibCommon.phxLayer.layerIsStatic()){if("scroll"===i)try{localStorage.setItem("sg.phxautorefresh.time",+new Date)}catch(e){}window.open("/","_self")}else window.nsglibCommon.phxLayer.layerIsOpened()&&(h(function(e){e.destroy("#Detail")}),e.phxAdsConfigurator.destroyLayerSlots(),t.close(o),e.headData.restore(),e.windowParams.restore(),window.dataLayer.push({layerCloseType:i}),e.dataLayer.restore(),n||history.pushState(void 0,void 0,r+a),e.phxAdsConfigurator.restoreMainPageAdsConfiguration(i,d),e.phxAdsConfigurator.restoreMainPageSlots(),"scroll"!==i&&e.gemius.hit(),e.backupYT&&e.backupYT.restore(),require(["local/common/playerSwitcher/index"],function(e){e.enablePlayers()}),window.store.restore())}function m(n){var o=new URL(n),i=o.origin+o.pathname;e.phxAdsConfigurator.saveOriginalAdsConfiguration(),require(["local/common/playerSwitcher/index"],function(e){e.disablePlayers()}),e.phxAdsConfigurator.destroyMainPageSlots(),t.open(),h(function(o){o?(o.render({type:"detail",container:"#Detail",params:{url:i},onRender:function(){e.phxAdsConfigurator.addStaticSlots(),t.runAmd(),window.dlApi.fetch()}}),o.on("dataLayerUpdateRequest",e.dataLayer.update),o.on("headUpdateRequest",function(t){t.referrer="unsafe-url",e.headData.set(t)}),o.on("enetWidget",function(e){e&&function(e){for(var t=0;t<e.length;t++){var n=document.createElement(e[t].tagName);null===document.getElementById(e[t].id)&&(n.id=e[t].id,void 0!==e[t].src&&(n.src=e[t].src),void 0!==e[t].async&&(n.async=e[t].async),void 0!==e[t].type&&(n.type=e[t].type),void 0!==e[t].innerHTML&&(n.innerHTML=e[t].innerHTML),void 0!==e[t].rel&&(n.rel=e[t].rel),void 0!==e[t].href&&(n.href=e[t].href),document.head.appendChild(n))}}(e)}),o.on("adsUpdateRequest",function(t){e.phxAdsConfigurator.updateAdsConfiguration(t,n),e.gemius.hit(t.gemius)}),o.on("windowParamsUpdateRequest",e.windowParams.update)):window.open(n,"_self")})}function h(t){if(t||(t=function(){}),n)t(n);else{var o={dlApi:window.onetAds||window.dlApi,ress:e.ress.getRessVersion(),websiteVariant:e.getWebsiteVariant()};window.PhxRenderer?(n=new window.PhxRenderer(o),t(n)):window.phxScripts&&function(e,t){var n=e.length;function o(){0==--n&&t()}for(var i=0;i<e.length;i++){var r=e[i],a=w(r);if(a)o();else{var d=document.createElement("script");d.onload=o,d.onerror=o,d.src=r,document.head.appendChild(d)}}}(window.phxScripts,function(){!function(e){var t=e.maxAttempts,n=e.timeout,o=e.truthTest,i=e.callback,r=0;!function e(){r++;o()||r===t?i():setTimeout(e,n)}()}({maxAttempts:5,timeout:100,truthTest:function(){return window.PhxRenderer},callback:function(){window.PhxRenderer&&(n=new window.PhxRenderer(o)),t(n)}})})}}function w(e){var t=document.head.querySelectorAll("script");return[].slice.call(t).filter(function(t){return t.src===e})[0]}});
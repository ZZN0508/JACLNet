YUI.add("af-applet-load",function(e){"use strict";var t=e.Af.AppletDom,a=e.Af.Utils,p=a.stringParseKV,l="applet-defer";function o(){}o.prototype={name:"applet.load",execute:function(a,o,n){if("applet.load"===o.action||"loadapplet"===o.action){var i=o.params.guid?t.getNode(o.params.guid):o.params.node;this.loadApplet(a,i,p(i.getData(l)),o.callback)}else"page.init"===o.action&&t.all(e.one("body"),e.bind(function(e){var t=e.getData(l);t&&"custom"!==(t=p(t)).when&&this.loadApplet(a,e,t,o.callback)},this));n()},replaceAppletContent:function(t,a){if(t&&a&&a.html){var p,l=e.Node.create(a.html);l=l.one("div.js-applet")||l,e.Af.Dom.setHTML(t,l.getHTML()),(p=a.js||a.assets)&&e.Af.Dom.jsAttach(p)}},loadApplet:function(o,n,i,r){if(!n)return r&&r("invalid node");var c=this,s=t.getGuid(n),d=t.getType(n),m=p(n.getData("applet-params")),u=e.merge({guid:s,type:d,content_id:"chrome"},m),f={id_param:"guid"};i&&(i.batch&&(f.batch=i.batch),i.timeout&&(f.timeout=i.timeout)),e.Af.Transport.read("applet.content",u,{config:f},function(t,p){return t||!a.objectGetValue(p,"content.chrome.html")?(e.Af.Message.show(n,{level:"error",token:"ERR_LOAD",template:"ape-applet-templates-reload"}),r&&r(t)):(n.removeAttribute("data-"+l),c.replaceAppletContent(n,p.content.chrome),o.execControllers({action:"applet.init",params:{node:n,replace:!0}}),e.use("stencil",function(e){e.Stencil.initAll(n)}),o.fire("appletdeferload",{applet:{guid:s,type:d}}),r&&r(null))})}},e.namespace("Af").AppletLoad=o},"@VERSION@",{requires:["af-applet-dom","af-message","af-transport","ape-applet-templates-reload"]});
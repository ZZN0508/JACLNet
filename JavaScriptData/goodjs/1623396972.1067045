(window.monolithJsonpFunction=window.monolithJsonpFunction||[]).push([["91a39cfd"],{10678:function(e,t,n){"use strict";var r=n(4194),s=n.n(r),i=function(){function e(){babelHelpers.classCallCheck(this,e),this.message={},this.transport="unknown"}return babelHelpers.createClass(e,[{key:"send",value:function(){throw new Error("not implemented")}},{key:"dispose",value:function(){throw new Error("not implemented")}}]),e}();i.TIMEOUT="timeout",i.ABORT="abort";var o=function(e){return e/1},a=o(15e3),u=o(15e3),c=o(25e3),l=o(1e4),d=o(1e3),f=o(8e3),h=o(3e4),p=o(500),v=o(500),E=o(25e3),m=o(500),g=function(e){return o(e<=100?1e4:e/10*1e3)},S=function(e){return 1.2*g(e)};function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var b=function(e){babelHelpers.inherits(n,e);var t=y(n);function n(e,r,s){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.timeout,c=void 0===a?u:a;if(babelHelpers.classCallCheck(this,n),i=t.call(this),!(e instanceof WebSocket))throw new Error("First argument should be a WebSocket instance");if(null===r||"object"!==babelHelpers.typeof(r)||r.constructor!==Object)throw new Error("Second argument should be a plain object");if("function"!=typeof s)throw new Error("Third argument should be a function");return i.ws=e,i.message=r,i.responseConfirmation=s,i.timeout=c,i.sendingTimeoutId=null,i.waitingTimeoutId=null,i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t})),i.transport="ws",i.handleMessage=i.handleMessage.bind(babelHelpers.assertThisInitialized(i)),i}return babelHelpers.createClass(n,[{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.ws||-1!==[WebSocket.CLOSED,WebSocket.CLOSING].indexOf(this.ws.readyState))return Promise.reject(new Error("WebSocket is not open: closed or closing"));if(this.ws.readyState===WebSocket.CONNECTING)return t<n.MAX_RESENDS?this.waitFor(p).then((function(){return e.send(t+1)})):Promise.reject(new Error("WebSocket is not open: still connecting after ".concat(n.MAX_RESENDS," tries")));try{this.ws.send(JSON.stringify(this.message)),this.ws.addEventListener("message",this.handleMessage)}catch(e){return Promise.reject(e)}return this.sendingTimeoutId=setTimeout((function(){e.dispose(n.TIMEOUT)}),this.timeout),this.promise}},{key:"dispose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.ABORT;clearTimeout(this.sendingTimeoutId),clearTimeout(this.waitingTimeoutId),e!==n.SENT&&this.reject(new Error(e)),this.ws.removeEventListener("message",this.handleMessage)}},{key:"waitFor",value:function(e){var t=this;return clearTimeout(this.waitingTimeoutId),new Promise((function(n){t.waitingTimeoutId=setTimeout(n,e)}))}},{key:"handleMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(e){}t&&this.responseConfirmation(t)&&(this.resolve(t),this.dispose(n.SENT))}}]),n}(i);b.TIMEOUT=i.TIMEOUT,b.ABORT=i.ABORT,b.SENT="sent",b.MAX_RESENDS=3;var I=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;babelHelpers.classCallCheck(this,e),this.nextId=0,this.nextId=t,this.odd=Boolean(t%2)}return babelHelpers.createClass(e,[{key:"incr",value:function(){var e=this.nextId;return this.nextId+=2,this.nextId>Number.MAX_SAFE_INTEGER&&(this.nextId=Number.MIN_SAFE_INTEGER+(this.odd?0:1)),e}}]),e}(),T=function(e,t){return Math.floor(Math.random()*(t-e))+e},_=function(){function e(t,n){var r=n.context,s=n.seq;babelHelpers.classCallCheck(this,e),this.reconnectionsCounter=0,this.context=r,this.requestsQueue=t,this.reconnectionTimeoutId=null,s&&(this.seq=s)}return babelHelpers.createClass(e,[{key:"connect",value:function(){clearTimeout(this.reconnectionTimeoutId)}},{key:"reconnect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.event,r=t.error,s=t.timeout,i=void 0===s?this.getReconnectAttemptTimeout():s;clearTimeout(this.reconnectionTimeoutId),this.isMaxReconnectionsExceeded()?this.switchTransport({event:n,error:r}):(this.reconnectionTimeoutId=setTimeout((function(){e.incrementReconnectionsCounter(),e.reconnectMethod()}),i),this.emitSystemMessage("reconnect",{event:n,error:r}))}},{key:"reconnectMethod",value:function(){throw Error("Unimplemented")}},{key:"disconnect",value:function(){clearTimeout(this.reconnectionTimeoutId),this.resetReconnectionsCounter(),this.requestsQueue.clear()}},{key:"emitSystemMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.event,r=t.error;this.context.emit("notify",{type:"system",value:{type:e,event:n,error:r}})}},{key:"transportCode",get:function(){return"undefined"}},{key:"getState",value:function(){return null}},{key:"getReconnectionCounter",value:function(){return this.reconnectionsCounter}},{key:"getReconnectAttemptTimeout",value:function(){var e=this.reconnectionsCounter>=3?f:d*Math.pow(2,this.reconnectionsCounter+1);return e+T(1,.2*e)}},{key:"incrementReconnectionsCounter",value:function(){this.reconnectionsCounter++}},{key:"resetReconnectionsCounter",value:function(){this.reconnectionsCounter=0}},{key:"isMaxReconnectionsExceeded",value:function(){return this.reconnectionsCounter>=3}},{key:"switchTransport",value:function(e){this.emitSystemMessage("switch",e)}}]),e}(),C=n(4195),O=1e3,R=3410,w=[4998],A=[O,1001,3401,3403,3429];function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var P=function(e){babelHelpers.inherits(s,e);var t,n,r=M(s);function s(e,t){var n;return babelHelpers.classCallCheck(this,s),(n=r.call(this,e,t)).runPingPolling=function(){clearTimeout(n.pingTimeoutId),n.pingTimeoutId=setTimeout(babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.request({method:"ping",params:{}});case 3:n.runPingPolling(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n.disconnect(4999);case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),c)},n.wasConnected=!1,n.options=t,n.ws=null,n.messageIdCounter=new I(1),n.isConnectionTimeOut=!1,n.hasSuccessfulRequest=null,n.pingTimeoutId=null,n.connectionTimeoutId=null,n.handleOpen=n.handleOpen.bind(babelHelpers.assertThisInitialized(n)),n.handleClose=n.handleClose.bind(babelHelpers.assertThisInitialized(n)),n.handleError=n.handleError.bind(babelHelpers.assertThisInitialized(n)),n.handleMessage=n.handleMessage.bind(babelHelpers.assertThisInitialized(n)),n}return babelHelpers.createClass(s,[{key:"buildEndpointUrl",value:function(){var e=this.options,t=e.wsEndpoint,n=e.appName,r=e.appVersion,s=encodeURIComponent(n),i=encodeURIComponent(r),o=1===t.split("?").length?"?":"&",a="".concat(t).concat(o,"use_seq=true&app_name=").concat(s)+"&app_version=".concat(i,"&old_notify=false&pv=4");return this.seq&&(a+="&seq=".concat(this.seq)),a}},{key:"transportCode",get:function(){return s.transportCode}},{key:"connect",value:(n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"connect",this).call(this),this.clearTimers(),e.prev=2,this.ws=new WebSocket(this.buildEndpointUrl()),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),this.switchTransport({error:e.t0}),e.abrupt("return");case 10:this.ws.addEventListener("open",this.handleOpen),this.ws.addEventListener("error",this.handleError),this.ws.addEventListener("close",this.handleClose),this.ws.addEventListener("message",this.handleMessage),this.connectionTimeoutId=setTimeout((function(){t.disconnect(4998)}),a);case 15:case"end":return e.stop()}}),e,this,[[2,6]])}))),function(){return n.apply(this,arguments)})},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O;babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"disconnect",this).call(this),this.clearTimers(),this.ws&&(this.ws.removeEventListener("close",this.handleError),this.ws.close(e),this.handleClose({code:e,message:"Transport run disconnect"}))}},{key:"clearSocket",value:function(){this.clearTimers(),this.ws&&(this.ws.removeEventListener("open",this.handleOpen),this.ws.removeEventListener("error",this.handleError),this.ws.removeEventListener("close",this.handleClose),this.ws.removeEventListener("message",this.handleMessage),this.ws=null,this.requestsQueue.clear())}},{key:"clearTimers",value:function(){clearTimeout(this.pingTimeoutId),clearTimeout(this.connectionTimeoutId)}},{key:"convertToAPIErrorCode",value:function(e){var t=C.c.ERROR_CODES,n=t.NOT_AUTHORIZED,r=t.INTERNAL_ERROR,s=t.CLOSE_NORMAL,i=t.MESSAGE_LOG_GONE;switch(e){case 3401:return n;case O:case 1001:return s;case R:return i;default:return r}}},{key:"getState",value:function(){return this.ws?this.ws.readyState:null}},{key:"request",value:(t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,s,i,o,a,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.method,r=t.params,this.getState()===WebSocket.OPEN){e.next=4;break}return s=new Error("WebSocket is not open"),e.abrupt("return",Promise.reject(s));case 4:return i=this.messageIdCounter.incr(),o={id:i,method:n,params:r,jsonrpc:"2.0"},a=function(e){return"2.0"===e.jsonrpc&&e.id===i},u=new b(this.ws,o,a),e.next=10,this.requestsQueue.send(u);case 10:if((c=e.sent).id=void 0,this.hasSuccessfulRequest=!0,this.runPingPolling(),!("error"in c)){e.next=17;break}throw L({},c.error,{rpcId:c.rpcId,requestId:c.requestId});case 17:return e.abrupt("return",c);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"reconnectMethod",value:function(){this.clearTimers(),this.connect()}},{key:"isMaxReconnectionsExceeded",value:function(){return!this.hasSuccessfulRequest&&babelHelpers.get(babelHelpers.getPrototypeOf(s.prototype),"isMaxReconnectionsExceeded",this).call(this)}},{key:"handleOpen",value:function(e){this.clearTimers(),this.wasConnected||(this.wasConnected=!0),this.emitSystemMessage("open",{event:e}),this.runPingPolling(),this.getReconnectionCounter()>0&&this.emitSystemMessage("reconnected",{event:e}),this.resetReconnectionsCounter()}},{key:"handleClose",value:function(e){this.clearSocket();var t=e.code,n=new C.c({code:this.convertToAPIErrorCode(t)});A.includes(t)?this.emitSystemMessage("close",{error:n,event:e}):1006===t&&!this.wasConnected||w.includes(t)?this.switchTransport({error:n,event:e}):(t===R&&(this.seq=void 0),this.reconnect({error:n,event:e}))}},{key:"handleError",value:function(e){var t=new C.c({code:this.convertToAPIErrorCode(e.code)});this.emitSystemMessage("error",{error:t,event:e})}},{key:"handleMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(t){return void this.emitSystemMessage("error",{error:new C.c({code:C.c.ERROR_CODES.PARSE_ERROR,message:"Parsing message error"}),event:{data:e.data}})}var n=t.seq||(t.value?t.value.seq:null);n&&(this.seq=n),this.context.emit("notify",t)}}],[{key:"isSupported",value:function(){var e=navigator.userAgent.match(/android\s([0-9\.]+)/i)||[],t=babelHelpers.slicedToArray(e,2)[1],n=parseFloat(t);return"undefined"!=typeof WebSocket&&(!n||n>=4.4)}}]),s}(_);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}P.transportCode="ws";var N,H=function(e){babelHelpers.inherits(n,e);var t=U(n);function n(e,r){var s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.timeout;return babelHelpers.classCallCheck(this,n),(s=t.call(this)).message=r,s.timeout=o,s.endpoint=e,s.xhr=null,s.promise=new Promise((function(e,t){s.resolve=e,s.reject=t})),s.transport="http",s}return babelHelpers.createClass(n,[{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=new XMLHttpRequest;return this.xhr=r,r.open("POST",this.endpoint),r.withCredentials=!0,this.timeout&&(r.timeout=this.timeout),r.onload=function(){if(200===r.status){var n;try{n=JSON.parse(r.responseText)}catch(t){return void e.reject(new Error("bad response format"))}if(void 0!==n.id&&null!==n.id&&e.message.id!==n.id)return t>=3?void e.reject(new Error("max rerun count exceeded")):void e.send(t+1);e.resolve(n)}else e.reject({code:r.status,message:r.responseText})},r.onerror=function(t){e.reject(t)},r.onabort=function(){e.reject(new Error(n.ABORT))},r.ontimeout=function(){e.reject(new Error(n.TIMEOUT))},r.setRequestHeader("accept",null),r.setRequestHeader("accept-language",null),r.send(JSON.stringify(this.message)),this.promise}},{key:"dispose",value:function(){this.xhr&&this.xhr.abort()}}]),n}(i);H.TIMEOUT=i.TIMEOUT,H.ABORT=i.ABORT;var x=new Uint8Array(16);function D(){if(!N&&!(N="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(x)}var j=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var q=function(e){return"string"==typeof e&&j.test(e)},F=[],Q=0;Q<256;++Q)F.push((Q+256).toString(16).substr(1));var G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(F[e[t+0]]+F[e[t+1]]+F[e[t+2]]+F[e[t+3]]+"-"+F[e[t+4]]+F[e[t+5]]+"-"+F[e[t+6]]+F[e[t+7]]+"-"+F[e[t+8]]+F[e[t+9]]+"-"+F[e[t+10]]+F[e[t+11]]+F[e[t+12]]+F[e[t+13]]+F[e[t+14]]+F[e[t+15]]).toLowerCase();if(!q(n))throw TypeError("Stringified UUID is invalid");return n};var B="__socket-client-tabs",W="__socket-client-updates",V=function(e,t,n){var r=(e=e||{}).random||(e.rng||D)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=r[s];return t}return G(r)}(),K=function(){try{return JSON.parse(localStorage.getItem(B)||"[]")}catch(e){}return null},z=function(e){try{localStorage.setItem(B,JSON.stringify(e))}catch(e){}};function Y(){try{window.localStorage.removeItem(W)}catch(e){}}function J(e){try{window.localStorage.setItem(W,JSON.stringify(e))}catch(e){}Y()}function X(e){Y();var t=function(t){var n=t.key,r=t.newValue;if(r&&n===W){var s;try{s=JSON.parse(r)}catch(e){return}e(s)}};return window.addEventListener("storage",t),function(){return window.removeEventListener("storage",t)}}function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var te=[C.a.NOT_AUTHORIZED],ne=function(e){babelHelpers.inherits(i,e);var t,n,r,s=ee(i);function i(e,t){var n;return babelHelpers.classCallCheck(this,i),(n=s.call(this,e,t)).tabCheck=function(){clearTimeout(n.healthCheckTimeoutId);var e=K(),t=S(e.length||1),r=Date.now(),s=e.filter((function(e){var n=e.lastTime;return r-n<=t})),i=e.find((function(e){return e.tabId===V}))||{},o=Boolean(i.isMaster),a=r-i.lastTime<=t,u=e.filter((function(e){return e.isMaster})),c=u.filter((function(e){var n=e.lastTime;return r-n<=t}));u.length&&c.length||o?o&&!a?(n.isMaster=!1,clearTimeout(n.pollingTimeoutId)):n.isMaster=o:(n.isMaster=!0,n.runPolling());var l=s.filter((function(e){return e.tabId!==V})).concat({tabId:V,lastTime:r,isMaster:n.isMaster});z(l),n.healthCheckTimeoutId=setTimeout(n.tabCheck,g(l.length))},n.fetchUpdates=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isMaster){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,n.request({method:"getSocketMessages",params:{seq:n.seq}});case 5:t=e.sent,J(r=t.result),n.handleUpdates(r),n.runPolling(),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(2),n.handleError(e.t0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),n.tryFetchUpdates=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.fetchUpdates();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),n.handleUpdates=function(e){e&&e.length&&e.forEach((function(e){return setTimeout((function(){n.context.emit("notify",e),e.seq&&(n.seq=e.seq)}),0)}))},n.handleError=function(e){n.clearTimers();var t=new C.c({code:n.convertToAPIErrorCode(e.code),message:e.message});if(te.includes(t.code))return n.emitSystemMessage("close",{error:t}),void n.unlistenTabUpdates();t.code===C.a.MESSAGE_LOG_GONE&&(n.seq=void 0),n.reconnect({error:t})},n.options=t,n.endpoint=n.buildEndpointUrl(),n.messageIdCounter=new I(1),n.pollingTimeoutId=null,n.healthCheckTimeoutId=null,n.isMaster=!1,n}return babelHelpers.createClass(i,[{key:"connect",value:(r=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,s,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=t.isOnlineEvent,babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"connect",this).call(this),this.clearTimers(),e.prev=3,e.next=6,this.request({method:"avito.getSession",params:{seq:this.seq}});case 6:r=e.sent,s=r.result,this.emitSystemMessage("open"),this.context.emit("notify",{type:"session",value:s}),s.seq&&(this.seq=s.seq),this.tabCheck(),this.listenTabUpdates(),n?this.tryFetchUpdates():this.runPolling(),this.getReconnectionCounter()>0&&this.emitSystemMessage("reconnected"),this.resetReconnectionsCounter(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),this.handleError(e.t0);case 21:case"end":return e.stop()}}),e,this,[[3,18]])}))),function(){return r.apply(this,arguments)})},{key:"buildEndpointUrl",value:function(){var e=this.options,t=e.httpEndpoint,n=e.appName,r=e.appVersion,s=encodeURIComponent(n),i=encodeURIComponent(r),o=1===t.split("?").length?"?":"&";return"".concat(t).concat(o,"app_name=").concat(s)+"&app_version=".concat(i,"&old_notify=false&pv=4")}},{key:"convertToAPIErrorCode",value:function(e){switch(e){case C.b:return C.a.NOT_AUTHORIZED;case C.a.MESSAGE_LOG_GONE:return e;default:return C.a.INTERNAL_ERROR}}},{key:"transportCode",get:function(){return i.transportCode}},{key:"disconnect",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"disconnect",this).call(this),this.clearTimers(),this.emitSystemMessage("close"),this.unlistenTabUpdates()}},{key:"runPolling",value:function(){clearTimeout(this.pollingTimeoutId),this.isMaster&&(this.pollingTimeoutId=setTimeout(this.tryFetchUpdates,l))}},{key:"reconnectMethod",value:(n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.seq){e.next=10;break}return this.tabCheck(),this.listenTabUpdates(),e.next=5,this.tryFetchUpdates();case 5:if(!e.sent){e.next=8;break}this.getReconnectionCounter()>0&&this.emitSystemMessage("reconnected"),this.resetReconnectionsCounter();case 8:e.next=11;break;case 10:this.connect();case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"listenTabUpdates",value:function(){this.unlistenTabUpdates(),this.unlistenTabUpdatesInternal=X(this.handleUpdates)}},{key:"unlistenTabUpdates",value:function(){this.unlistenTabUpdatesInternal&&(this.unlistenTabUpdatesInternal(),this.unlistenTabUpdatesInternal=null)}},{key:"request",value:(t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,s,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.method,r=t.params,s={jsonrpc:"2.0",id:this.messageIdCounter.incr(),method:n,params:r},i=new H(this.endpoint,s),e.next=5,this.requestsQueue.send(i);case 5:if(!("error"in(o=e.sent))){e.next=9;break}throw $({},o.error,{rpcId:o.rpcId,requestId:o.requestId});case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"clearTimers",value:function(){clearTimeout(this.pollingTimeoutId),clearTimeout(this.healthCheckTimeoutId)}}]),i}(_);ne.transportCode="http";var re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.maxParallelRequests,r=void 0===n?10:n,s=t.hashFields,i=void 0===s?[]:s;if(babelHelpers.classCallCheck(this,e),"number"!=typeof r||isNaN(r))throw new Error("maxParallelRequests is not a number");if(!Array.isArray(i))throw new Error("hashFields is not an array");this.maxParallelRequests=r,this.hashFields=i,this.waitingQueue=[],this.processingQueue=[],this.sendingPromisesByHash={}}return babelHelpers.createClass(e,[{key:"send",value:function(e){var t=this;if(!(e instanceof i))throw new Error("argument is not instance of Request");var n=this.getHash(e.message),r=this.sendingPromisesByHash[n];if(r)return r;if(this.processingQueue.length>=this.maxParallelRequests){var s=new Promise((function(r,s){var i={request:e,resolve:r,reject:s,hash:n};t.waitingQueue.push(i)}));return this.sendingPromisesByHash[n]=s,s}return this.forceSend(e,n)}},{key:"clear",value:function(){this.waitingQueue.forEach((function(e){return e.request.dispose()})),this.processingQueue.forEach((function(e){return e.dispose()})),this.waitingQueue=[],this.processingQueue=[],this.sendingPromisesByHash={}}},{key:"remove",value:function(e){if(!(e instanceof i))throw new Error("argument is not instance of Request");var t=this.getHash(e.message);this.processingQueue=this.processingQueue.filter((function(t){return t!==e})),this.waitingQueue=this.waitingQueue.filter((function(t){return t.request!==e})),delete this.sendingPromisesByHash[t],e.dispose(),this.processWaitingQueue()}},{key:"forceSend",value:function(e,t){var n=this;t=t||this.getHash(e.message);var r=e.send();return this.sendingPromisesByHash[t]=r,this.processingQueue.push(e),r.then((function(r){return n.onRequestEnd(e,t),r})).catch((function(r){return n.onRequestEnd(e,t),Promise.reject(r)}))}},{key:"processWaitingQueue",value:function(){if(this.waitingQueue.length){var e=this.waitingQueue.shift(),t=e.request,n=e.resolve,r=e.reject,s=e.hash;this.forceSend(t,s).then((function(e){return n(e)})).catch((function(e){return r(e)}))}}},{key:"getHash",value:function(e){if(!this.hashFields.length)return JSON.stringify(e);var t=this.hashFields.reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{});return JSON.stringify(t)}},{key:"onRequestEnd",value:function(e,t){this.processingQueue=this.processingQueue.filter((function(t){return t!==e})),delete this.sendingPromisesByHash[t],this.processWaitingQueue()}}]),e}(),se=function(){function e(t,n){var r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{messagesLogSize:20};babelHelpers.classCallCheck(this,e),this.userId=null,this.sessionGetTime=null,this.messageLogs=[],this.context=n,this.messagesLogSize=s.messagesLogSize,this.userId=null,this.transport=null,this.messageLogs=[],this.initTime=Date.now(),this.sessionGetTime=null,this.sendEvent=s.sendEvent,this.setRequestsQueue(t),this.context.on("notify",(function(t){"session"===t.type&&(r.sessionGetTime=Date.now()-r.initTime,r.userId=t.value.userId),["session","system"].includes(t.type)&&r.logMessage(e.NOTIFY,t)}))}return babelHelpers.createClass(e,[{key:"patchRequestsSend",value:function(t){var n=this,r=t.send;t.send=function(s){n.logMessage(e.OUT,s.message,s.transport);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return r.call.apply(r,[t,s].concat(o)).then((function(t){return n.logMessage(e.IN,t,s.transport),t}))}}},{key:"setTransport",value:function(e){this.transport=e}},{key:"setRequestsQueue",value:function(e){this.requests=e,e&&this.patchRequestsSend(e)}},{key:"stringifyMessage",value:function(e){var t=Object.assign({},e),n=t.value;return n&&n.event instanceof Event&&(n.event={code:n.event.code}),n&&n.error instanceof Error&&(n.error={message:n.error.message,stack:n.error.stack}),JSON.stringify(t)}},{key:"logMessage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.UNKNOWN,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.transport,s="string"==typeof n?n:this.stringifyMessage(n),i={time:Date.now(),type:t,transport:r,message:s};this.messageLogs.length>=this.messagesLogSize&&this.messageLogs.shift(),this.messageLogs.push(i)}},{key:"logScStateToCs",value:function(e){var t;this.sendEvent&&this.sendEvent(5015,{uid:null!==(t=this.userId)&&void 0!==t?t:void 0,msg_state_id:e,version:1})}}]),e}();function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}se.UNKNOWN="unknown",se.NOTIFY="notify",se.OUT="out",se.IN="in";var ae=function(e){babelHelpers.inherits(n,e);var t=oe(n);function n(e){var r,s=e.wsEndpoint,i=e.httpEndpoint,o=e.appName,a=e.appVersion;if(babelHelpers.classCallCheck(this,n),(r=t.call(this)).handleOnline=function(){r.clearTimers(),r.onlineTimeoutId=setTimeout((function(){r.transport&&r.transport.connect({isOnlineEvent:!0})}),v+T(1,.2*v))},r.handleOffline=function(){r.clearTimers(),r.transport&&r.transport.disconnect()},!s&&!i)throw new Error("At list one endpoint should be provided");r.config={context:babelHelpers.assertThisInitialized(r),wsEndpoint:s,httpEndpoint:i,appName:o,appVersion:a};var u=new re({hashFields:["method","params"]}),c=r.resolveTransport();return r.transport=new c(u,r.config),r.requestsQueue=u,r.userId=null,r.serverTimeOffset=0,r.noSwitchTimeoutId=null,r.onlineTimeoutId=null,r.logger=new se(u,babelHelpers.assertThisInitialized(r)),r.logger.setTransport(r.transport.transportCode),r.listenNotifications(),r.listenNavigatorOnlineAPI(),r}return babelHelpers.createClass(n,[{key:"destroy",value:function(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}},{key:"resolveTransport",value:function(e){var t=this.config,n=t.httpEndpoint,r=t.wsEndpoint;return n&&r?P.isSupported()?e?this.transport instanceof ne?P:ne:P:ne:r?P:ne}},{key:"connect",value:function(){return this.clearTimers(),this.transport.connect()}},{key:"disconnect",value:function(){return this.clearTimers(),this.transport.disconnect()}},{key:"request",value:function(e){return this.transport.request(e)}},{key:"listenNotifications",value:function(){var e=this;this.on("notify",(function(t){switch(t.type){case"session":return e.handleSessionNotify(t);case"system":return e.handleSystemNotify(t);default:return null}}))}},{key:"listenNavigatorOnlineAPI",value:function(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}},{key:"handleSystemNotify",value:function(e){"switch"===e.value.type&&this.switchTransport()}},{key:"handleSessionNotify",value:function(e){var t=e.value,n=t.serverTime,r=t.userId;this.userId=r,n&&(this.serverTimeOffset=1e3*Math.round((Date.now()-n)/1e3),this.emit("notify",{type:"time",value:{offset:this.serverTimeOffset}}))}},{key:"switchTransport",value:function(){var e=this;this.clearTimers();var t=this.resolveTransport(!0),n=this.transport;n.disconnect(),this.requestsQueue=new re({hashFields:["method","params"]}),this.transport=new t(this.requestsQueue,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.config,{seq:n.seq})),this.logger.setTransport(this.transport.transportCode),this.logger.setRequestsQueue(this.requestsQueue),n.transportCode!==this.transport.transportCode?this.transport.connect():this.noSwitchTimeoutId=setTimeout((function(){return e.transport.connect()}),h)}},{key:"getLogs",value:function(){var e=this.logger;return{userId:e.userId,transport:e.transport,logs:e.messageLogs,uptime:Date.now()-e.initTime,sessionGetTime:e.sessionGetTime}}},{key:"clearTimers",value:function(){clearTimeout(this.noSwitchTimeoutId),clearTimeout(this.onlineTimeoutId)}}],[{key:"isSupportedWS",value:function(){return P.isSupported()}}]),n}(s.a),ue="disconnect",ce="offline detected",le="received stop code",de="ws zombie connection detected",fe="switch to ws",he="disconnect",pe="bad response format",ve="defer timeout",Ee=function e(t){var n=this;babelHelpers.classCallCheck(this,e),this.timeoutId=0,"number"==typeof t&&(this.timeoutId=window.setTimeout((function(){n.reject({message:ve})}),t)),this.promise=new Promise((function(e,t){n.resolve=function(t){clearTimeout(n.timeoutId),e(t)},n.reject=function(e){clearTimeout(n.timeoutId),t(e)}}))},me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))};function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=function(){function e(t,n,r){var s=this;babelHelpers.classCallCheck(this,e),this.requestsQueue=[],this.idCounter=new I(1),this.pingTimeoutId=0,this.connectTimeoutId=0,this.reconnectTimeoutId=0,this.reconnectCounter=0,this.didWork=!1,this.handleOpen=function(){clearTimeout(s.connectTimeoutId),s.runPingPolling(),s.emitSystemMessage("open")},this.handleClose=function(e){var t=e.code,n={code:t,message:e.reason};A.includes(t)?s.disconnect(le,t):1006!==t||s.didWork?(t===R&&(s.seq=void 0),s.reconnect(n)):s.switchTransport("ws abnormal close",n)},this.handleMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return void s.emitSystemMessage("error",{code:C.a.PARSE_ERROR,message:pe})}s.requestsQueue=s.requestsQueue.filter((function(e){return!("jsonrpc"in t)||t.id!==e.id||(s.runPingPolling(),e.defer.resolve(t),!1)})),"jsonrpc"in t||(s.seq="session"===t.type?t.value.seq:t.seq,s.emit("notify",t))},this.runPingPolling=function(){clearTimeout(s.pingTimeoutId),s.pingTimeoutId=window.setTimeout(babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.request("ping",{});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:s.runPingPolling();case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),s.didWork?c:m)},this.runOpenTimeout=function(){clearTimeout(s.connectTimeoutId),s.connectTimeoutId=window.setTimeout((function(){s.switchTransport("ws open timeout",{message:"connect timeout error"})}),a)},this.config=t,this.emit=n,this.logger=r}return babelHelpers.createClass(e,[{key:"connect",value:function(e){this.runOpenTimeout();try{this.wsInstance=new WebSocket(this.buildEndpointUrl()),this.wsInstance.addEventListener("open",this.handleOpen),this.wsInstance.addEventListener("close",this.handleClose),this.wsInstance.addEventListener("message",this.handleMessage)}catch(e){this.switchTransport("ws create error",{message:e.message})}}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;if(this.wsInstance){var n={code:t,reason:e,message:he};this.clearSocket(t),this.clearRequestsQueue(ue),e!==de&&this.emitSystemMessage("close",n)}}},{key:"reconnect",value:function(e){var t=this;if(clearTimeout(this.reconnectTimeoutId),this.reconnectCounter<3){var n;(null===(n=this.wsInstance)||void 0===n?void 0:n.readyState)!==WebSocket.CLOSED&&this.disconnect(de);var r=this.getReconnectAttemptTimeout();this.reconnectTimeoutId=window.setTimeout((function(){t.reconnectCounter++,t.connect()}),r),this.emitSystemMessage("reconnect",e)}else this.switchTransport("maximum ws reconnect exceeded",e)}},{key:"switchTransport",value:function(e,t){this.clearTimers(),this.clearRequestsQueue("switch to fallback"),this.clearSocket(),this.config.httpEndpoint?this.emitSystemMessage("switch",Se({},t,{reason:e})):this.emitSystemMessage("close",Se({},t,{reason:e}))}},{key:"getReconnectAttemptTimeout",value:function(){var e=this.reconnectCounter>=3?f:d*Math.pow(2,this.reconnectCounter+1);return e+T(1,.2*e)}},{key:"buildEndpointUrl",value:function(){var e=this.config,t=e.wsEndpoint,n=void 0===t?"":t,r=e.appName,s=void 0===r?"":r,i=e.appVersion,o=void 0===i?"":i,a=encodeURIComponent(s),u=encodeURIComponent(o),c=1===n.split("?").length?"?":"&",l="".concat(n).concat(c,"use_seq=true")+"&app_name=".concat(a,"&app_version=").concat(u,"&old_notify=false&pv=5");return this.seq&&(l+="&seq=".concat(this.seq)),l}},{key:"request",value:function(e,t){var n,r=this,s={method:e,params:t,id:this.idCounter.incr(),jsonrpc:"2.0"},i=new Ee(u),o=i.promise.then((function(e){if(r.logger&&r.logger.logMessage(se.IN,e,"ws"),e.error)throw Se({},e.error,{rpcId:e.rpcId,requestId:e.requestId});return r.didWork||r.emitSystemMessage("working"),r.didWork=!0,r.reconnectCounter=0,e}),(function(e){throw e.message===ve&&(r.didWork?r.reconnect(Se({},e,{reason:de})):r.switchTransport("ws request timeout error",e)),e}));return(null===(n=this.wsInstance)||void 0===n?void 0:n.readyState)!==WebSocket.OPEN?i.reject({message:"websocket is not open"}):(this.requestsQueue.push(Se({},s,{defer:i})),this.logger&&this.logger.logMessage(se.OUT,s,"ws"),this.wsInstance.send(JSON.stringify(s))),o}},{key:"emitSystemMessage",value:function(e,t){this.emit("notify",{type:"system",value:{type:e,error:t}})}},{key:"clearTimers",value:function(){clearTimeout(this.pingTimeoutId),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId)}},{key:"clearRequestsQueue",value:function(e){this.requestsQueue.forEach((function(t){return t.defer.reject({message:e})})),this.requestsQueue=[]}},{key:"clearSocket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O;this.wsInstance&&(this.wsInstance.removeEventListener("open",this.handleOpen),this.wsInstance.removeEventListener("close",this.handleClose),this.wsInstance.removeEventListener("message",this.handleMessage),this.wsInstance.close(e),this.wsInstance=void 0)}},{key:"setEmitter",value:function(e){this.emit=e}},{key:"setLogger",value:function(e){this.logger=e}}]),e}();function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Te=function(){function e(t,n,r){var s=this;babelHelpers.classCallCheck(this,e),this.pollingTimeoutId=0,this.healthCheckTimeoutId=0,this.checkWsTimeoutId=0,this.idCounter=new I(1),this.isMaster=!1,this.didWork=!1,this.fetchUpdatesErrorCounter=0,this.fetchSessionErrorCounter=0,this.requestsQueue=[],this.wsClient=null,this.handleError=function(e){return e.code===C.b?(s.disconnect(le,e),!0):(e.code===C.a.MESSAGE_LOG_GONE&&(s.seq=void 0,s.fetchSession()),!1)},this.handleUpdates=function(e){e&&e.length&&e.forEach((function(e){return setTimeout((function(){s.emit("notify",e),e.seq&&(s.seq=e.seq)}),0)}))},this.fetchUpdates=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.isMaster){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,s.request("getSocketMessages",{seq:s.seq});case 5:t=e.sent,n=t.result,s.fetchUpdatesErrorCounter>0&&(r={reason:"fetch updates success",message:"fetch updates success message"},s.emitSystemMessage("reconnected",r)),s.fetchUpdatesErrorCounter=0,J(n),s.handleUpdates(n),s.runPolling(),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(2),!s.handleError(e.t0)){e.next=19;break}return e.abrupt("return");case 19:s.fetchUpdatesErrorCounter++,s.fetchUpdatesErrorCounter>3?s.disconnect("maximum fetch updates error exceeded",e.t0):(s.emitSystemMessage("reconnect",e.t0),s.runPolling());case 21:case"end":return e.stop()}}),e,null,[[2,14]])}))),this.fetchSession=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.request("avito.getSession",{seq:s.seq});case 2:return t=e.sent,n=t.result,s.emit("notify",{type:"session",value:n}),n.seq&&(s.seq=n.seq),s.didWork||s.emitSystemMessage("working"),s.didWork=!0,s.fetchSessionErrorCounter=0,e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)}))),this.tabCheck=function(){var e;clearTimeout(s.healthCheckTimeoutId);var t=null!==(e=K())&&void 0!==e?e:[],n=S(t.length||1),r=Date.now(),i=t.filter((function(e){var t=e.lastTime;return r-t<=n})),o=t.find((function(e){return e.tabId===V})),a=Boolean(null==o?void 0:o.isMaster),u=!!o&&r-o.lastTime<=n,c=t.filter((function(e){return e.isMaster})),l=c.filter((function(e){var t=e.lastTime;return r-t<=n}));c.length&&l.length||a?a&&!u?(s.isMaster=!1,clearTimeout(s.pollingTimeoutId)):s.isMaster=a:(s.isMaster=!0,s.runPolling());var d=i.filter((function(e){return e.tabId!==V})).concat({tabId:V,lastTime:r,isMaster:s.isMaster});z(d),s.healthCheckTimeoutId=window.setTimeout(s.tabCheck,g(d.length))},this.handleWsEmit=function(e){var t=arguments.length<=1?void 0:arguments[1];if("notify"===e&&"system"===t.type)switch(t.value.type){case"working":s.switchTransport();break;case"close":case"switch":s.runWsCheck()}return!1},this.emit=n,this.config=t,this.logger=r}var t;return babelHelpers.createClass(e,[{key:"connect",value:(t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clearTimers(),e.prev=1,e.next=4,this.fetchSession();case 4:this.fetchSessionErrorCounter>0&&(n={reason:"fetch session success",message:"fetch session success message"},this.emitSystemMessage("reconnected",n)),this.fetchSessionErrorCounter=0,this.emitSystemMessage("open"),this.tabCheck(),this.listenTabUpdates(),this.runWsCheck(),t===fe?this.fetchUpdates():this.runPolling(),e.next=31;break;case 13:if(e.prev=13,e.t0=e.catch(1),!this.handleError(e.t0)){e.next=18;break}return e.abrupt("return");case 18:if(this.fetchSessionErrorCounter++,this.didWork){e.next=23;break}this.disconnect("unable fetch session",e.t0),e.next=31;break;case 23:if(!(this.fetchSessionErrorCounter<=2)){e.next=30;break}return this.emitSystemMessage("reconnect",e.t0),e.next=27,me(this.getSessionAttemptTimeout());case 27:this.connect(),e.next=31;break;case 30:this.disconnect("maximum getSession error exceeded",e.t0);case 31:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(e){return t.apply(this,arguments)})},{key:"disconnect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{message:he};this.clearTimers(),this.clearRequestsQueue(ue),this.unlistenTabUpdates(),this.emitSystemMessage("close",Ie({},t,{reason:e,code:e===ce?0:t.code})),this.wsClient&&(this.wsClient.disconnect(ue),this.wsClient=null)}},{key:"buildEndpointUrl",value:function(){var e=this.config,t=e.httpEndpoint,n=void 0===t?"":t,r=e.appName,s=void 0===r?"":r,i=e.appVersion,o=void 0===i?"":i,a=encodeURIComponent(s),u=encodeURIComponent(o),c=1===n.split("?").length?"?":"&";return"".concat(n).concat(c,"app_name=").concat(a)+"&app_version=".concat(u,"&old_notify=false&pv=5")}},{key:"request",value:function(e,t){var n=this,r=this.buildEndpointUrl(),s={method:e,params:t,id:this.idCounter.incr(),jsonrpc:"2.0"},i=new Ee(u),o=new XMLHttpRequest,a=i.promise.then((function(e){return n.requestsQueue=n.requestsQueue.filter((function(e){return e.id===s.id})),e}),(function(e){throw n.requestsQueue=n.requestsQueue.filter((function(e){return e.id===s.id})),o.status!==XMLHttpRequest.DONE&&(o.onabort=null,o.abort()),e}));return this.requestsQueue.push(Ie({},s,{defer:i})),o.open("POST",r),o.withCredentials=!0,o.timeout=u,o.onload=function(){if(200===o.status){var e;try{e=JSON.parse(o.responseText)}catch(e){return void i.reject({message:pe})}n.logger&&n.logger.logMessage(se.IN,e,"http"),e.error?i.reject(Ie({},e.error,{rpcId:e.rpcId,requestId:e.requestId})):i.resolve(e)}else i.reject({code:o.status,message:o.responseText})},o.onerror=function(){i.reject({message:"xhr error"})},o.onabort=function(){i.reject({message:"xhr error"})},o.ontimeout=function(){i.reject({message:"xhr error"})},this.logger&&this.logger.logMessage(se.OUT,s,"http"),o.send(JSON.stringify(s)),a}},{key:"listenTabUpdates",value:function(){this.unlistenTabUpdates(),this.unlistenTabUpdatesInternal=X(this.handleUpdates)}},{key:"unlistenTabUpdates",value:function(){this.unlistenTabUpdatesInternal&&(this.unlistenTabUpdatesInternal(),this.unlistenTabUpdatesInternal=void 0)}},{key:"clearTimers",value:function(){clearTimeout(this.pollingTimeoutId),clearTimeout(this.healthCheckTimeoutId),clearTimeout(this.checkWsTimeoutId),this.fetchUpdatesErrorCounter=0,this.fetchSessionErrorCounter=0}},{key:"runPolling",value:function(){clearTimeout(this.pollingTimeoutId),this.isMaster&&(this.pollingTimeoutId=window.setTimeout(this.fetchUpdates,l))}},{key:"emitSystemMessage",value:function(e,t){this.emit("notify",{type:"system",value:{type:e,error:t}})}},{key:"runWsCheck",value:function(){var e=this;clearTimeout(this.checkWsTimeoutId),this.config.wsEndpoint&&(this.checkWsTimeoutId=window.setTimeout((function(){e.wsClient=new ye(e.config,e.handleWsEmit),e.wsClient.seq=e.seq,e.wsClient.connect("ws check")}),E))}},{key:"getSessionAttemptTimeout",value:function(){var e=this.fetchSessionErrorCounter>=2?f:d*Math.pow(2,this.fetchSessionErrorCounter+1);return e+T(1,.2*e)}},{key:"clearRequestsQueue",value:function(e){this.requestsQueue.forEach((function(t){t.defer.reject({message:e})})),this.requestsQueue=[]}},{key:"switchTransport",value:function(){this.clearTimers(),this.clearRequestsQueue(fe),this.unlistenTabUpdates();var e={reason:fe,message:"switch to ws"};this.emitSystemMessage("switch",e),this.emitSystemMessage("open",e),this.wsClient&&(this.wsClient=null)}}]),e}();function _e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var Ce=function(e){babelHelpers.inherits(n,e);var t=_e(n);function n(e){var r;if(babelHelpers.classCallCheck(this,n),(r=t.call(this)).activeClient=null,r.isSubscribed=!1,r.isOffline=!1,r.scState=0,r.emitInternal=function(e){for(var t,n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];if("notify"===e){var o=s[0].type;switch(o){case"session":r.handleSessionNotify(s[0]);break;case"system":r.handleSystemNotify(s[0])}}return(t=r).emit.apply(t,[e].concat(s))},r.handleOnline=function(){r.isOffline=!1,r.connect("online")},r.handleOffline=function(){r.isOffline=!0,r.disconnect(ce)},r.handleFocus=function(){r.isOffline||r.connect("focus event")},!e.wsEndpoint&&!e.httpEndpoint)throw Error("one of wsEndpoint or httpEndpoint should be listed");return r.config=e,r.logger=new se(null,babelHelpers.assertThisInitialized(r),{messagesLogSize:20,sendEvent:e.sendEvent}),r.setState(0),r}return babelHelpers.createClass(n,[{key:"transport",get:function(){return this.activeClient instanceof ye?{transportCode:"ws"}:this.activeClient instanceof Te?{transportCode:"http"}:{transportCode:null}}},{key:"connect",value:function(e){this.activeClient||(this.listenWindowEvents(),this.config.wsEndpoint?(this.activeClient=new ye(this.config,this.emitInternal,this.logger),this.logger.setTransport("ws"),this.setState(10)):(this.activeClient=new Te(this.config,this.emitInternal,this.logger),this.logger.setTransport("http"),this.setState(30)),this.activeClient.seq=this.lastSeq,this.activeClient.connect(e))}},{key:"disconnect",value:function(e){this.activeClient&&(this.lastSeq=this.activeClient.seq,this.activeClient.disconnect(e),this.activeClient=null,this.setState(0))}},{key:"destroy",value:function(){this.unlistenWindowEvents(),this.disconnect("destroy")}},{key:"request",value:function(e){if(!this.activeClient)throw{message:"client disconnected"};return this.activeClient.request(e.method,e.params)}},{key:"getLogs",value:function(){var e=this.logger;return{userId:e.userId,transport:e.transport,logs:e.messageLogs,uptime:Date.now()-e.initTime,sessionGetTime:e.sessionGetTime}}},{key:"setState",value:function(e){this.scState=e,this.logger.logScStateToCs(e)}},{key:"listenWindowEvents",value:function(){this.isSubscribed||(window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),window.addEventListener("focus",this.handleFocus),this.isSubscribed=!0)}},{key:"unlistenWindowEvents",value:function(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),window.removeEventListener("focus",this.handleFocus),this.isSubscribed=!1}},{key:"handleSystemNotify",value:function(e){switch(e.value.type){case"switch":this.activeClient instanceof ye?(this.lastSeq=this.activeClient.seq,this.activeClient=new Te(this.config,this.emitInternal,this.logger),this.logger.setTransport("http"),this.activeClient.seq=this.lastSeq,this.activeClient.connect(fe),this.setState(30)):this.activeClient instanceof Te&&this.activeClient.wsClient&&(this.activeClient=this.activeClient.wsClient,this.activeClient.setEmitter(this.emitInternal),this.activeClient.setLogger(this.logger),this.logger.setTransport("ws"),this.setState(20));break;case"reconnect":this.setState(this.activeClient instanceof ye?10:30);break;case"working":this.setState(this.activeClient instanceof ye?20:40);break;case"close":var t;this.lastSeq=null===(t=this.activeClient)||void 0===t?void 0:t.seq,this.activeClient=null,this.setState(0)}}},{key:"handleSessionNotify",value:function(e){var t=e.value,n=t.serverTime,r=t.userId;this.userId=r,n&&(this.serverTimeOffset=1e3*Math.round((Date.now()-n)/1e3),this.emit("notify",{type:"time",value:{offset:this.serverTimeOffset}}))}}],[{key:"isSupportedWS",value:function(){var e=navigator.userAgent.match(/android\s([0-9\.]+)/i)||[],t=babelHelpers.slicedToArray(e,2)[1],n=parseFloat(t);return"undefined"!=typeof WebSocket&&(!n||n>=4.4)}}]),n}(s.a),Oe=n(4196),Re=n(4189),we=n.n(Re),Ae=n(4202),ke=["type"];function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var Ue=function(e){babelHelpers.inherits(n,e);var t=Pe(n);function n(){return babelHelpers.classCallCheck(this,n),t.apply(this,arguments)}return babelHelpers.createClass(n,[{key:"handleSessionNotify",value:function(){var e;Oe.a.logSession();for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];(e=babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"handleSessionNotify",this)).call.apply(e,[this].concat(r))}}]),n}(Ce),Ne=function(e){babelHelpers.inherits(n,e);var t=Pe(n);function n(){return babelHelpers.classCallCheck(this,n),t.apply(this,arguments)}return babelHelpers.createClass(n,[{key:"handleSessionNotify",value:function(){var e;Oe.a.logSession();for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];(e=babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"handleSessionNotify",this)).call.apply(e,[this].concat(r))}}]),n}(ae),He=function(){function e(t){var n=this;babelHelpers.classCallCheck(this,e),this.defer=null,this.client=null,this.getLogs=function(){var e;return null===(e=n.client)||void 0===e?void 0:e.getLogs()},this.getTransport=function(){var e;return null===(e=n.client)||void 0===e?void 0:e.transport},this.config=t,this.session={userId:null,timeCorrectionOffset:0,backupUserId:null}}var t;return babelHelpers.createClass(e,[{key:"connect",value:function(e,t){var n=this;Oe.a.logTransportConnect(),this.session=Me({},this.session,{userId:null,timeCorrectionOffset:0}),this.config.appName=t,this.config.isTestAccount&&we()(window,"avito.messenger.Client",this),4===this.config.version?this.client=new Ne(this.config):this.client=new Ue(this.config),this.addNotificationsListener(e),this.defer=new Ae.a;return this.client.on("notify",(function e(t){var r,s;"session"===t.type&&(null===(r=n.defer)||void 0===r||r.resolve(!0),null===(s=n.client)||void 0===s||s.removeListener("notify",e));"close"!==t.type&&"error"!==t.type||n.disconnect(t)})),this.client.connect(),this.defer.promise}},{key:"disconnect",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"disconnect";(this.client&&(this.client.disconnect(),this.removeNotificationsListener(),this.client.destroy(),this.client=null),this.defer)&&(null===(e=this.defer)||void 0===e||null===(t=e.reject)||void 0===t||t.call(e,n));this.defer=null}},{key:"request",value:(t=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.defer&&this.defer.promise&&this.client)){e.next=6;break}return e.next=3,this.defer.promise;case 3:return e.next=5,this.client.request({method:t,params:n});case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",{result:{}});case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addNotificationsListener",value:function(e){var t=this;this.client&&this.client.on("notify",(function(n){return t.hotifyHandler(e,n)}))}},{key:"removeNotificationsListener",value:function(){this.client&&this.client.removeAllListeners("notify")}},{key:"hotifyHandler",value:function(e,t){switch(t.type){case"system":var n=t.value;return e({type:n.type,value:babelHelpers.objectWithoutProperties(n,ke)});case"time":return this.session.timeCorrectionOffset=t.value.offset,e(t);case"session":var r=t.value.userId;return this.session.userId=r,e(t);default:var s=t.type;return s?e(Me({},t,{type:s})):t}}},{key:"getMessages",value:function(e){return this.request("messenger.history",e)}},{key:"sendMessage",value:function(e,t,n,r){return this.request("avito.sendTextMessage",{channelId:e,text:t,randomId:n,templates:r})}},{key:"sendReactionMessage",value:function(e,t,n,r){return this.request("messenger.sendReactionMessage",{channelId:e,text:t,randomId:n,templates:r})}},{key:"sendItemMessage",value:function(e,t,n){return this.request("avito.sendItemMessage",{channelId:e,itemId:t,randomId:n})}},{key:"getThread",value:function(e){return this.request("avito.getChatById.v2",e)}},{key:"getThreads",value:function(e){var t;return e.limit=Math.min(100,null!==(t=e.limit)&&void 0!==t?t:0),this.request("avito.getChats.v3",e)}},{key:"readThread",value:function(e){return this.request("messenger.readChat",{channelId:e})}},{key:"sendTyping",value:function(e,t){return this.request("messenger.sendTyping",{channelId:e,userIds:t})}},{key:"removeThreads",value:function(e){return this.request("messenger.clearMessageHistoryMulti",{channelIds:e})}},{key:"getLastActionTimes",value:function(e){return this.request("messenger.getLastActionTimes",{userIds:e})}},{key:"getUsersBlacklist",value:function(e){return this.request("avito.getBlacklist",e)}},{key:"addUsersBlacklist",value:function(e,t){return this.request("avito.blacklistAdd",{users:e,reasonId:t})}},{key:"removeUserBlacklist",value:function(e){return this.request("avito.blacklistRemove",{userId:e})}},{key:"getBlacklistReasons",value:function(){return this.request("messenger.getBlacklistReasons",{})}},{key:"getBodyItems",value:function(e){return this.request("avito.getBodyItems.v2",{ids:e})}},{key:"getUsers",value:function(e,t){return this.request("messenger.getUsers.v1",{channelId:e,userIds:t})}},{key:"getBodyFile",value:function(e){return this.request("messenger.getFile.v1",{fileId:e})}},{key:"getFoldersCounters",value:function(e){return this.request("messenger.getUnreadCount.v2",{folders:e})}},{key:"getItemsForFilter",value:function(e){return this.request("avito.getItemsForFilter",e)}},{key:"getItemsForAttach",value:function(e){return this.request("avito.getItemsForAttach.v2",e)}},{key:"sendImageMessage",value:function(e,t,n){return this.request("avito.sendImageMessage",{channelId:e,imageId:t,randomId:n})}},{key:"sendFileMessage",value:function(e,t,n){return this.request("messenger.sendFile.v1",{channelId:e,fileId:t,randomId:n})}},{key:"createFile",value:function(e){return this.request("messenger.createFile.v1",{channelId:e})}},{key:"sendLinkMessage",value:function(e,t,n){return this.request("messenger.sendLinkMessage",{channelId:e,url:t,randomId:n})}},{key:"getBodyImages",value:function(e){return this.request("avito.getBodyImages",{ids:e})}},{key:"getReplySuggest",value:function(e){return this.request("suggest.getReplySuggest",{channelIds:e})}},{key:"getChannelPhone",value:function(e){return this.request("messenger.getPhoneByChannelId.v1",{channelId:e})}},{key:"createChat",value:function(e){return this.request("avito.chatCreateByItemId.v1",{itemId:e})}},{key:"createU2UChat",value:function(e){return this.request("messenger.chatCreateByUserId.v1",{opponentId:e})}},{key:"getGeoReverse",value:function(e){var t=e.lon,n=e.lat;return this.request("messenger.reverseGeo.v1",{lon:t,lat:n})}},{key:"getFavoritePlaces",value:function(e,t){var n=e.lon,r=e.lat;return this.request("messenger.favoritePlaces.v1",{itemLocation:{lon:n,lat:r},channelId:t})}},{key:"geoSearch",value:function(e){var t=e.query,n=e.channelId,r=e.mapCenter;return this.request("messenger.geoSearch.v1",{query:t,centerPoint:r,channelId:n})}},{key:"sendLocationMessage",value:function(e){return this.request("messenger.sendLocationMessage.v1",e)}},{key:"confirmSuspect",value:function(e){return this.request("messenger.suspectConfirm",e)}},{key:"cancelSuspect",value:function(e){return this.request("messenger.suspectCancel",e)}},{key:"search",value:function(e){return this.request("messenger.search.v1",e)}},{key:"deleteMessage",value:function(e){return this.request("messenger.deleteMessage.v1",e)}},{key:"getLiquidityStats",value:function(){return this.request("messenger.liquidity.v1",{})}},{key:"updateChannelsTags",value:function(e){return this.request("messenger.updateFolderTags.v1",e)}},{key:"getAutoReplySettings",value:function(){return this.request("messenger.getAutoreplySettings.v1",{})}},{key:"saveAutoReplySettings",value:function(e){return this.request("messenger.saveAutoreplySettings.v1",e)}},{key:"getSettings",value:function(){return this.request("messenger.getSettings.v1",{})}}],[{key:"isSupportedWS",value:function(){return ae.isSupportedWS()}}]),e}(),xe=n(4204),De=n(3956),je=n.n(De),qe=n(4208),Fe=n(4191),Qe=n(4203),Ge=n(4205);n.d(t,"b",(function(){return Be}));var Be=Fe.c&&He.isSupportedWS(),We=new He({get wsEndpoint(){var e=Object(xe.f)();return je.a.get("forceHTTPFallback")||e.isForceHttp?void 0:je.a.get("socketServer")},get httpEndpoint(){return je.a.get("httpFallback")},get isTestAccount(){return je.a.get("isTestAccount")},get version(){var e,t,n=(t=null===(e=je.a.get("experiments"))||void 0===e?void 0:e[Qe.b],Object(Qe.d)(t)?5:4);return we()(window,"avito.messenger.Client.version",n),n},sendEvent:Ge.b,appVersion:qe.version});t.a=We},10761:function(e,t,n){"use strict";var r=n(4213),s=n(4257),i=n(4234),o=n(4214);function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var u=function(e){babelHelpers.inherits(n,e);var t=a(n);function n(e){var s;return babelHelpers.classCallCheck(this,n),(s=t.call(this,e)).type=r.c.SYSTEM,s}return n}(o.a),c=n(4258);function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var d=function(e){babelHelpers.inherits(n,e);var t=l(n);function n(e){var s;return babelHelpers.classCallCheck(this,n),(s=t.call(this,e)).type=r.c.CALL,s}return n}(o.a);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var h=function(e){babelHelpers.inherits(n,e);var t=f(n);function n(e){var s;return babelHelpers.classCallCheck(this,n),(s=t.call(this,e)).type=r.c.APP_CALL,s}return n}(o.a),p=n(4259),v=n(4260);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var m=function(e){babelHelpers.inherits(n,e);var t=E(n);function n(e){var s;return babelHelpers.classCallCheck(this,n),(s=t.call(this,e)).type=r.c.DELETED,s}return n}(o.a),g=n(4212),S=n(4256),y=n.n(S),b=n(4238),I=n.n(b),T=n(3890),_=n(4261),C="messenger-phone-call";Object(_.a)({name:C,originalWidth:16,originalHeight:16,svg:T.createElement("path",{d:"M10.435 9.776a1 1 0 011.136.018l2.74 1.957a1.002 1.002 0 01.125 1.52l-1.582 1.583a.5.5 0 01-.354.147C6.149 15 1 9.85 1 3.5a.5.5 0 01.146-.354L2.73 1.564a1 1 0 011.52.126l1.957 2.74a1 1 0 01.019 1.135L4.97 7.447a8.54 8.54 0 003.583 3.584l1.882-1.255zM12.146 3.146l-2.5 2.5.708.708 2.5-2.5L15 6V1h-5l2.146 2.146z"})});var O="messenger-phone-call-incoming";Object(_.a)({name:O,originalWidth:16,originalHeight:16,svg:T.createElement("path",{d:"M5.564 9.776a1 1 0 00-1.135.018l-2.74 1.957a1 1 0 00-.126 1.52l1.583 1.583a.5.5 0 00.354.147C9.851 15 15 9.85 15 3.5a.5.5 0 00-.146-.354L13.27 1.564a1 1 0 00-1.52.126L9.793 4.43a1 1 0 00-.019 1.135l1.255 1.882a8.54 8.54 0 01-3.583 3.584L5.564 9.776zM.646 1.354l.708-.708 2.5 2.5L6 1v5H1l2.146-2.146-2.5-2.5z"})});var R="messenger-missed-call";Object(_.a)({name:R,originalWidth:16,originalHeight:16,svg:T.createElement(T.Fragment,null,T.createElement("path",{d:"M10.435 9.775a1 1 0 011.136.019l2.74 1.956a1 1 0 01.125 1.52l-1.582 1.584A.5.5 0 0112.5 15C6.149 15 1 9.851 1 3.5a.5.5 0 01.146-.354L2.73 1.564a1 1 0 011.52.126l1.957 2.739a1 1 0 01.019 1.136L4.97 7.447a8.541 8.541 0 003.583 3.583l1.882-1.255z",fill:"#B8B8B8"}),T.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 5.293l.707.707 2.5-2.5 2.147 2.146v-5h-5L12.5 2.793l-2.5 2.5z",fill:"#FF6163"}))});var w="messenger-missed-call-incoming";Object(_.a)({name:w,originalWidth:16,originalHeight:16,svg:T.createElement(T.Fragment,null,T.createElement("path",{d:"M5.564 9.775a1 1 0 00-1.135.019l-2.74 1.956a1 1 0 00-.126 1.52l1.583 1.584A.5.5 0 003.5 15C9.851 15 15 9.851 15 3.5a.5.5 0 00-.146-.354L13.27 1.564a1 1 0 00-1.52.126L9.793 4.429a1 1 0 00-.019 1.136l1.255 1.882a8.54 8.54 0 01-3.583 3.583L5.564 9.775z",fill:"#B8B8B8"}),T.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.5 4.207L1 1.707 1.707 1l2.5 2.5 2.147-2.146v5h-5L3.5 4.207z",fill:"#FF6163"}))});var A=n(10987),k=n(4305),L=n(4306);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n.d(t,"h",(function(){return N})),n.d(t,"g",(function(){return H})),n.d(t,"i",(function(){return x})),n.d(t,"e",(function(){return D})),n.d(t,"f",(function(){return j})),n.d(t,"c",(function(){return q})),n.d(t,"d",(function(){return F})),n.d(t,"b",(function(){return Q})),n.d(t,"a",(function(){return G})),n.d(t,"j",(function(){return B}));var U=[r.c.DELETED,r.c.CALL,r.c.APP_CALL];function N(e){var t=[],n=new Set,r=new Set;return e.forEach((function(e){var s=H(e),i=s.message,o=s.imageIds,a=s.itemIds;t.push(i),o.forEach((function(e){return r.add(e)})),a.forEach((function(e){return n.add(e)}))})),{messages:t,imageIds:Array.from(r),itemIds:Array.from(n)}}function H(e){var t,n,o,a,l,f,E=e,S=new Set,b=new Set;switch(e.type){case r.c.TEXT:t=s.a;break;case r.c.ITEM:t=c.a,e.body.itemId&&S.add(e.body.itemId);break;case r.c.IMAGE:t=i.a,e.body.imageId&&b.add(e.body.imageId);break;case r.c.CALL:t=d;break;case r.c.APP_CALL:t=h;break;case r.c.DELETED:t=m;break;case r.c.LINK:var T,_,C,O,R;if(t=p.a,null==e||null===(T=e.body)||void 0===T||null===(_=T.preview)||void 0===_?void 0:_.value.imageId)b.add(null==e||null===(R=e.body)||void 0===R?void 0:R.preview.value.imageId);"image"===(null==e||null===(C=e.body)||void 0===C||null===(O=C.preview)||void 0===O?void 0:O.type)&&(E=P({},n=e,{type:r.c.IMAGE,body:{randomId:null===(o=n.body)||void 0===o?void 0:o.randomId,imageId:null===(a=n.body)||void 0===a||null===(l=a.preview)||void 0===l||null===(f=l.value)||void 0===f?void 0:f.imageId}}),t=i.a);break;case r.c.SYSTEM:t=u,(e.body.chunks||[]).forEach((function(e){e.type===r.a.IMAGE&&b.add(e.value.imageId)}));break;case r.c.LOCATION:t=v.a;break;case r.c.FILE:t=g.a;break;default:t=s.a}var w=new t(E);if(e.updates){var A=I()(e.updates,(function(e){return-e.ts})).map((function(t){var n=t.action,r=t.ts,s=t.type,i=t.body,o=H(P({},e,{updates:void 0,type:s,body:i})),a=o.message,u=o.itemIds,c=o.imageIds;return u.forEach((function(e){return S.add(e)})),c.forEach((function(e){return b.add(e)})),{action:n,date:new Date(r/1e4),message:a}}));w.versions=A}return w.isMine&&(w.sendingStatus=w.sendingStatus||r.d.SENT),{message:w,imageIds:Array.from(b).filter((function(e){return!y()(e)})),itemIds:Array.from(S).filter((function(e){return!y()(e)}))}}function x(e,t,n){return n.map((function(n){return n.id===e?t instanceof o.a?t:n.assign(t):n}))}function D(e,t){return e&&t?e.toISOString().substr(0,10)===t.toISOString().substr(0,10):null}function j(e,t){var n=D(t.date,new Date);return e&&n&&!D(t.date,e.date)}function q(e,t,n){return Boolean(t)&&t.fromUid===e.fromUid&&D(t.date,e.date)&&!n}function F(e){return e&&e.isMine&&!U.includes(e.type)}function Q(e){if(!e)return null;var t=e.isMine?"  ":"  ";return e.type===r.c.CALL?t:e.type===r.c.APP_CALL?e.body.text||t:null}function G(e){return e.type===r.c.APP_CALL?e.isMine?"messenger-phone-call":"messenger-phone-call-incoming":e.isMine?"messenger-missed-call":"messenger-missed-call-incoming"}var B=function(e){var t=new A.a({text:e,urlsAreTrusted:!0});return t.hasSpecialPhrases()?t.phrases.reduce((function(e,t){return e+(t.type===k.a.URL?Object(L.b)(t.text):t.text)}),""):e}},10963:function(e,t,n){"use strict";n.r(t);var r=n(4187),s=n(4204),i=n(10678),o=n(4234),a=n(4259),u=n(4258),c=n(4257),l=n(4260),d=n(4309),f=n(4212),h=n(4211),p=function(e,t){return e.upload.hash[t]},v=function(e,t){var n=p(e,t);return Boolean(null==n?void 0:n.success)},E=n(4236),m=n(4213);function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),a=new o.a({id:n,body:{imageId:t,randomId:n},channelId:e});return{type:r.a.MESSAGE_IMAGE_SEND,radar:!0,promise:i.a.sendImageMessage(e,t,n),id:n,channelId:e,imageId:t,message:a}}n.d(t,"sendImageMessage",(function(){return g})),n.d(t,"sendImageMessageWithUpload",(function(){return S})),n.d(t,"sendFileMessage",(function(){return y})),n.d(t,"sendFileMessageWithUpload",(function(){return b})),n.d(t,"sendLocationMessage",(function(){return I})),n.d(t,"sendLinkMessage",(function(){return T})),n.d(t,"getImages",(function(){return _})),n.d(t,"getItems",(function(){return C})),n.d(t,"getFile",(function(){return O})),n.d(t,"getUsers",(function(){return R})),n.d(t,"sendItemMessage",(function(){return w})),n.d(t,"reset",(function(){return A})),n.d(t,"sendMessage",(function(){return k})),n.d(t,"sendAutoReply",(function(){return L})),n.d(t,"setDraftMessage",(function(){return M})),n.d(t,"setDraftMessages",(function(){return P})),n.d(t,"removeTempMessage",(function(){return U})),n.d(t,"getMessages",(function(){return N})),n.d(t,"confirmSuspect",(function(){return H})),n.d(t,"cancelSuspect",(function(){return x})),n.d(t,"deleteMessage",(function(){return D}));var S=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e);return function(){var r=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function r(s,i){var o,a,u,c,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=v(i(),n),a="",o){r.next=9;break}return r.next=5,s(Object(h.uploadImage)(e,t,n));case 5:if(!(u=r.sent).isError){r.next=8;break}return r.abrupt("return",u);case 8:a=Object.keys(u)[0];case 9:if((c=Object(E.d)(i(),n))&&(null==c?void 0:c.type)===m.c.IMAGE){r.next=12;break}throw Error("expected image message");case 12:if(l=c.body.imageId||a){r.next=15;break}throw Error("expected image with imageId");case 15:return r.next=17,s(g(e,l,n));case 17:return r.abrupt("return",r.sent);case 18:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()};function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),o=new f.a({id:n,body:{fileId:t.fileId,name:t.name,sizeBytes:t.sizeBytes,randomId:n},channelId:e});return{type:r.a.MESSAGE_FILE_SEND,radar:!0,promise:i.a.sendFileMessage(e,t.fileId,n),id:n,channelId:e,fileId:t.fileId,message:o}}var b=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e);return function(){var r=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function r(s,i){var o,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(v(i(),n)){r.next=7;break}return r.next=4,s(Object(h.uploadFile)(e,t,n));case 4:if(!(o=r.sent).isError){r.next=7;break}return r.abrupt("return",o);case 7:if((a=Object(E.d)(i(),n))&&(null==a?void 0:a.type)===m.c.FILE){r.next=10;break}throw Error("expected file message");case 10:if(a.body.fileId){r.next=13;break}throw Error("expected file with fileId");case 13:return r.next=15,s(y(e,a.body,n));case 15:return r.abrupt("return",r.sent);case 16:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()};function I(e){var t=e.channelId,n=e.lon,o=e.lat,a=e.title,u=e.kind,c=e.randomId,d=void 0===c?Object(s.c)(t):c,f=new l.a({id:d,body:{lon:n,lat:o,title:a,kind:u,randomId:d},channelId:t});return{type:r.a.MESSAGE_LOCATION_SEND,radar:!0,promise:i.a.sendLocationMessage({channelId:t,lon:n,lat:o,title:a,kind:u,randomId:d}),id:d,channelId:t,message:f}}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),o=new a.a({id:n,body:{url:t,randomId:n},channelId:e});return{type:r.a.MESSAGE_LINK_SEND,radar:!0,promise:i.a.sendLinkMessage(e,t,n),id:n,channelId:e,message:o}}function _(e){return{type:r.a.MESSAGES_IMAGES_REQUEST,promise:i.a.getBodyImages(e),radar:!0,imageIds:e}}function C(e){return{type:r.a.MESSAGES_ITEMS_REQUEST,promise:i.a.getBodyItems(e),radar:!0,itemIds:e}}function O(e){return{type:r.a.MESSAGES_FILE_REQUEST,promise:i.a.getBodyFile(e),radar:!0,fileId:e}}function R(e,t){return{type:r.a.MESSAGES_USERS_REQUEST,promise:i.a.getUsers(e,t),channelId:e,userIds:t}}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),o=new u.a({id:n,channelId:e,body:{itemId:t.value.id,randomId:n}});return{type:r.a.MESSAGE_ITEM_SEND,promise:i.a.sendItemMessage(e,t.value.id,n),id:n,radar:!0,channelId:e,itemData:t,message:o}}function A(){return{type:r.a.MESSAGES_RESET}}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new c.a({id:n,isReaction:o,channelId:e,body:{text:t,randomId:n}});return{type:r.a.MESSAGE_SEND,promise:o?i.a.sendReactionMessage(e,t,n):i.a.sendMessage(e,t,n),id:n,text:t.trim(),radar:!0,channelId:e,message:a}}function L(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Object(s.c)(e),a=new d.a({id:o,channelId:e,body:{text:t,randomId:o}});return{type:r.a.MESSAGE_AUTO_REPLY_SEND,promise:i.a.sendMessage(e,t,o,n),id:o,radar:!0,message:a}}function M(e){var t=e.channelId,n=e.text,s=e.interlocutorId;return{type:r.a.MESSAGE_DRAFT,channelId:t,text:n,interlocutorId:s}}function P(e){return{type:r.a.SET_DRAFT_MESSAGES,draftMessages:e}}var U=function(e,t){return function(){var n=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function n(s,i){var o,a,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=i(),null==(u=p(a,t))||null===(o=u.abort)||void 0===o||o.call(u),s({type:r.a.MESSAGE_TEMP_REMOVE,radar:!0,channelId:e,messageId:t});case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()};function N(e){var t=e.channelId,n=e.before,s=e.after,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.isPatch,u=o.isApiFetchEvent;return{type:r.a.MESSAGES_REQUEST,promise:i.a.getMessages({channelId:t,before:n}),channelId:t,before:n,after:s,radar:!0,isPatch:a,isApiFetchEvent:u}}function H(e){var t=e.userId,n=e.messageId,s=e.itemId,o=e.channelId;return{type:r.a.MESSAGE_CONFIRM_SUSPECT_REQUEST,promise:i.a.confirmSuspect({userId:t,messageId:n,itemId:s}),userId:t,messageId:n,itemId:s,channelId:o,radar:!0}}function x(e){var t=e.channelId,n=e.messageId;return{type:r.a.MESSAGE_CANCEL_SUSPECT_REQUEST,promise:i.a.cancelSuspect({channelId:t,messageId:n}),channelId:t,messageId:n,radar:!0}}function D(e){var t=e.messageId;return{type:r.a.MESSAGE_DELETE,promise:i.a.deleteMessage({messageId:t}),messageId:t,radar:!0}}},10971:function(e,t,n){"use strict";var r=n(4238),s=n.n(r),i=n(4247),o=n.n(i),a=n(4251),u=n.n(a),c=n(4252),l=n.n(c),d=n(10761),f=n(4307),h=n(4308),p=n(4207),v=191717891;function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){return s()(e,(function(e){var t=e.updated,n=e.sortingTimestamp;return null!=n?n:-t}))}function g(e,t){var n=e&&document.querySelector('[data-marker="'.concat(e,'"]')),r=document.querySelectorAll('[data-marker="'.concat(t,'"]')),s=0,i=0;if(n)s=n.clientHeight;else if(r.length){var o,a=null===(o=document.querySelector('[data-marker="'.concat(t,'"]')))||void 0===o?void 0:o.parentElement;a&&(s=window.innerHeight-(null==a?void 0:a.getBoundingClientRect().top))}for(var u,c=0,l=0;u=r[c];c++){var d=u.clientHeight;if(l+d>=s)break;l+=d,i+=1}return i}function S(e,t){var n=e.lastMessage,r=function(e){var t,n,r,s={};_(e)&&e.lastMessage&&(s[h.a.CHANNEL_CHANGE_FOLDER]={route:h.a.CHANNEL_CHANGE_FOLDER,title:" "});return(null!==(t=null===(n=e.context)||void 0===n||null===(r=n.value)||void 0===r?void 0:r.menu)&&void 0!==t?t:[]).reduce((function(e,t){var n=t.deepLink,r=void 0===n?"":n,s=t.icon,i=t.confirmation,o=t.title,a=Object(h.b)(r),u=a.route,c=void 0===u?"":u,l=a.query;return e[c]={icon:s,confirmation:i,query:l,title:o,route:c},e}),s)}(e),s=function(e,t){if(e.info)return e.info;var n={name:""},r=e.users.filter((function(e){return e.id!==t}));if(I(e)){var s,i,o;n.name=null!==(s=null===(i=e.context)||void 0===i?void 0:i.value.name)&&void 0!==s?s:"",n.status=null===(o=e.context)||void 0===o?void 0:o.value.status}else if(T(e)){var a,u,c,l,d,f=r[0];n.name=f.name,n.avatar=null===(a=f.publicUserProfile)||void 0===a||null===(u=a.avatar)||void 0===u?void 0:u.images,n.link={title:null==f||null===(c=f.publicUserProfile)||void 0===c||null===(l=c.deepLink)||void 0===l?void 0:l.title,url:null==f||null===(d=f.publicUserProfile)||void 0===d?void 0:d.url}}else if(1===r.length){var h,p,v,E,m,g=r[0];n.name=g.name,n.avatar=null===(h=g.publicUserProfile)||void 0===h||null===(p=h.avatar)||void 0===p?void 0:p.images,n.link={title:null==g||null===(v=g.publicUserProfile)||void 0===v||null===(E=v.deepLink)||void 0===E?void 0:E.title,url:null==g||null===(m=g.publicUserProfile)||void 0===m?void 0:m.url},n.userId=g.id}else n.name=r.map((function(e){return null==e?void 0:e.name})).join(", ");return n}(e,t),i=function(e){var t;if(null===(t=e.context)||void 0===t?void 0:t.value.attachMenu)return e.context.value.attachMenu;var n=_(e),r=T(e),s=I(e),i={};i.image={title:" ",enableForUnanswered:!n},(n||r)&&(i.item={title:" "},i.location={title:"  "});s&&e.users.find((function(e){return e.id===v}))&&(i.file={title:" ",enableForUnanswered:!0,maxSizeBytes:26214400});return i}(e),o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{lastMessage:void 0,chatActions:r,info:s});if(o.context&&(o.context.value.attachMenu=i),n){var a=Object(d.g)(n).message;o.lastMessage=a}return o}n.d(t,"m",(function(){return m})),n.d(t,"d",(function(){return g})),n.d(t,"l",(function(){return S})),n.d(t,"g",(function(){return y})),n.d(t,"a",(function(){return b})),n.d(t,"j",(function(){return I})),n.d(t,"k",(function(){return T})),n.d(t,"h",(function(){return _})),n.d(t,"i",(function(){return C})),n.d(t,"b",(function(){return O})),n.d(t,"f",(function(){return R})),n.d(t,"c",(function(){return w})),n.d(t,"e",(function(){return A}));var y=function(e){var t;return(null==e||null===(t=e.readOnly)||void 0===t?void 0:t.reason)===f.b};function b(e){var t=Date.now();return e.filter((function(e){var n=e.updated;return t-n/1e4<=25056e5}))}function I(e){var t;return"system"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)}function T(e){var t;return"user"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)}function _(e){var t;return"item"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)}function C(e){var t,n;return Boolean("system"===(null==e||null===(t=e.context)||void 0===t?void 0:t.type)&&(null===(n=e.tags)||void 0===n?void 0:n.includes(p.f)))}function O(e,t){if(!e.length)return{};var n=e.map((function(e){var n=t.find((function(t){var n=t.channelId;return e===n}));return(null==n?void 0:n.chatActions)?Object.values(n.chatActions):[]}));return l()(o.a.apply(void 0,babelHelpers.toConsumableArray(n).concat(["route"])),"route")}var R=function(e){return e===p.e?p.b:p.e},w=function(e){return{marker:"changeFolderConfirmPopup",title:"    ".concat(p.d[R(e)],"?"),description:" ,    .",confirmText:", ",cancelText:",  "}},A=function(e){return Object.keys(p.g).find((function(t){return u()(p.g[t],null!=e?e:[]).length}))}},10987:function(e,t,n){"use strict";var r=n(4305),s=n(4303),i=n.n(s);n.d(t,"a",(function(){return u}));var o=/(\s+)/,a=[r.a.URL],u=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=n.text,a=n.urlsAreTrusted,u=void 0!==a&&a;if(babelHelpers.classCallCheck(this,e),this.counters={},i()(r.a).forEach((function(e){return t.counters[e]=0})),this.phrases=[],!s&&!s.length||!u)return this;var l=s.split(o);l.forEach((function(e){var n=new r.b({text:e,type:c(e)});t.phrases.push(n),t.counters[n.type]++}))}return babelHelpers.createClass(e,[{key:"hasSpecialPhrases",value:function(){var e=this;return a.some((function(t){return Boolean(e.counters[t])}))}},{key:"toString",value:function(){return this.substring(0,this.phrases.length)}},{key:"substring",value:function(t,n){return e.phrasesToString(this.phrases.slice(t,n))}},{key:"first",get:function(){return this.phrases[0]}},{key:"last",get:function(){return this.phrases[this.phrases.length-1]}}],[{key:"phrasesToString",value:function(e){return e.map((function(e){return e.text})).join("")}}]),e}();function c(e){var t=r.a.ANY,n=r.a.URL,s=r.a.DELIMITER;return o.test(e)?s:/^(?:(?:https?):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-zA-Z0-9]-*)*[a-zA-Z0-9]+)(?:\.(?:[a-zA-Z0-9]-*)*[a-zA-Z0-9]+)*(?:\.(?:[a-zA-Z]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i.test(e)?n:t}},4174:function(e,t,n){var r=n(3967),s=n(4169),i=n(4013);e.exports=function(e,t){return i(s(e,t,r),e+"")}},4178:function(e,t,n){var r=n(4179)();e.exports=r},4179:function(e,t){e.exports=function(e){return function(t,n,r){for(var s=-1,i=Object(t),o=r(t),a=o.length;a--;){var u=o[e?a:++s];if(!1===n(i[u],u,i))break}return t}}},4181:function(e,t,n){var r=n(4058),s=n(4005);e.exports=function(e){return s(e)&&r(e)}},4186:function(e,t,n){var r=n(4040),s=n(4058),i=n(4026),o=n(3980);e.exports=function(e,t,n){if(!o(n))return!1;var a=typeof t;return!!("number"==a?s(n)&&i(t,n.length):"string"==a&&t in n)&&r(n[t],e)}},4187:function(e,t,n){"use strict";n.d(t,"b",(function(){return i}));var r=n(4188),s=Object(r.a)({INIT:null,APP_RESET:null,MESSAGES_RESET:null,EVENTS_CHAT_TYPING:null,SEND_CHAT_TYPING:null,SEND_CHAT_TYPING_SUCCESS:null,SEND_CHAT_TYPING_FAIL:null,EVENTS_MESSAGE:null,EVENTS_CHANNELS_UPDATE:null,EVENTS_SESSION:null,EVENTS_MESSAGE_UPDATE:null,EVENTS_BLACKLIST_ADDED:null,EVENTS_BLACKLIST_REMOVED:null,EVENTS_CHAT_REMOVED:null,EVENTS_CHAT_SHOW:null,EVENTS_CHAT_HIDE:null,EVENTS_SYSTEM_OPEN:null,EVENTS_SYSTEM_CLOSE:null,EVENTS_SYSTEM_RECONNECT:null,EVENTS_SYSTEM_RECONNECTED:null,EVENTS_TIME:null,EVENTS_MESSAGES_READ:null,EVENTS_CHAT_READ:null,EVENTS_SYSTEM_ERROR:null,EVENTS_SYSTEM_SWITCH:null,EVENTS_UNKNOWN:null,APP_ACTIVE_CHANGE:null,APP_SET_STATUS:null,APP_TABS_SYNC:null,IMAGE_UPLOAD:null,IMAGE_UPLOAD_SUCCESS:null,IMAGE_UPLOAD_FAIL:null,FILE_UPLOAD:null,FILE_UPLOAD_SUCCESS:null,FILE_UPLOAD_FAIL:null,FILE_CREATE:null,FILE_CREATE_SUCCESS:null,FILE_CREATE_FAIL:null,SET_UPLOAD_PROGRESS:null,MESSAGE_IMAGE_SEND:null,MESSAGE_IMAGE_SEND_SUCCESS:null,MESSAGE_IMAGE_SEND_FAIL:null,MESSAGE_FILE_SEND:null,MESSAGE_FILE_SEND_SUCCESS:null,MESSAGE_FILE_SEND_FAIL:null,MESSAGE_LINK_SEND:null,MESSAGE_LINK_SEND_SUCCESS:null,MESSAGE_LINK_SEND_FAIL:null,MESSAGE_SEND:null,MESSAGE_SEND_FAIL:null,MESSAGE_SEND_SUCCESS:null,MESSAGE_DELETE:null,MESSAGE_DELETE_SUCCESS:null,MESSAGE_DELETE_FAIL:null,MESSAGE_DRAFT:null,MESSAGE_TEMP_REMOVE:null,MESSAGES_REQUEST:null,MESSAGES_REQUEST_SUCCESS:null,MESSAGES_REQUEST_FAIL:null,SET_DRAFT_MESSAGES:null,LAST_ACTION_TIMES_REQUEST:null,LAST_ACTION_TIMES_REQUEST_SUCCESS:null,LAST_ACTION_TIMES_REQUEST_FAIL:null,CHANNEL_RESET_ACTIONS:null,CHANNEL_RESET:null,CHANNEL_REQUEST:null,CHANNEL_REQUEST_FAIL:null,CHANNEL_REQUEST_SUCCESS:null,CHANNEL_INITIAL_REQUEST:null,CHANNEL_INITIAL_REQUEST_FAIL:null,CHANNEL_INITIAL_REQUEST_SUCCESS:null,GEO_MESSAGES_MARKERS_REQUEST:null,GEO_MESSAGES_MARKERS_REQUEST_SUCCESS:null,GEO_MESSAGES_MARKERS_REQUEST_FAIL:null,GEO_MESSAGES_MARKERS_SET:null,MESSAGES_IMAGES_REQUEST:null,MESSAGES_IMAGES_REQUEST_FAIL:null,MESSAGES_IMAGES_REQUEST_SUCCESS:null,MESSAGES_ITEMS_REQUEST:null,MESSAGES_ITEMS_REQUEST_FAIL:null,MESSAGES_ITEMS_REQUEST_SUCCESS:null,MESSAGES_FILE_REQUEST:null,MESSAGES_FILE_REQUEST_FAIL:null,MESSAGES_FILE_REQUEST_SUCCESS:null,MESSAGES_USERS_REQUEST:null,MESSAGES_USERS_REQUEST_FAIL:null,MESSAGES_USERS_REQUEST_SUCCESS:null,MESSAGE_ITEM_SEND:null,MESSAGE_ITEM_SEND_FAIL:null,MESSAGE_ITEM_SEND_SUCCESS:null,MESSAGE_AUTO_REPLY_SEND:null,MESSAGE_AUTO_REPLY_SEND_SUCCESS:null,MESSAGE_AUTO_REPLY_SEND_FAIL:null,MESSAGE_CONFIRM_SUSPECT_REQUEST:null,MESSAGE_CONFIRM_SUSPECT_REQUEST_FAIL:null,MESSAGE_CONFIRM_SUSPECT_REQUEST_SUCCESS:null,MESSAGE_CANCEL_SUSPECT_REQUEST:null,MESSAGE_CANCEL_SUSPECT_REQUEST_FAIL:null,MESSAGE_CANCEL_SUSPECT_REQUEST_SUCCESS:null,CHANNELS_REQUEST:null,CHANNELS_REQUEST_FAIL:null,CHANNELS_REQUEST_SUCCESS:null,PINNED_CHANNELS_REQUEST:null,PINNED_CHANNELS_REQUEST_FAIL:null,PINNED_CHANNELS_REQUEST_SUCCESS:null,CHANNELS_RESET_FETCHED:null,CHANNEL_READ_REQUEST:null,CHANNEL_READ_REQUEST_SUCCESS:null,CHANNEL_READ_REQUEST_FAIL:null,PHONE_REQUEST:null,PHONE_REQUEST_SUCCESS:null,PHONE_REQUEST_FAIL:null,PHONE_RESET:null,FOLDERS_COUNTERS_REQUEST:null,FOLDERS_COUNTERS_REQUEST_SUCCESS:null,FOLDERS_COUNTERS_REQUEST_FAIL:null,ROUTER_SET:null,BLACKLIST_REQUEST:null,BLACKLIST_REQUEST_FAIL:null,BLACKLIST_REQUEST_SUCCESS:null,BLACKLIST_ADD_USERS_REQUEST:null,BLACKLIST_ADD_USERS_REQUEST_FAIL:null,BLACKLIST_ADD_USERS_REQUEST_SUCCESS:null,BLACKLIST_REMOVE_USER_REQUEST:null,BLACKLIST_REMOVE_USER_REQUEST_FAIL:null,BLACKLIST_REMOVE_USER_REQUEST_SUCCESS:null,BLACKLIST_REASONS_REQUEST:null,BLACKLIST_REASONS_REQUEST_SUCCESS:null,BLACKLIST_REASONS_REQUEST_FAIL:null,BLACKLIST_TOOLTIP_HIDE:null,ATTACH_ITEMS_REQUEST:null,ATTACH_ITEMS_REQUEST_FAIL:null,ATTACH_ITEMS_REQUEST_SUCCESS:null,ATTACH_ITEMS_RESET:null,PLATFORM_METHOD_CALL_REQUEST:null,PLATFORM_METHOD_CALL_REQUEST_SUCCESS:null,PLATFORM_METHOD_CALL_REQUEST_FAIL:null,CHANNEL_CREATE_REQUEST:null,CHANNEL_CREATE_REQUEST_SUCCESS:null,CHANNEL_CREATE_REQUEST_FAIL:null,GEO_REVERSE_REQUEST:null,GEO_REVERSE_REQUEST_SUCCESS:null,GEO_REVERSE_REQUEST_FAIL:null,MESSAGE_LOCATION_SEND:null,MESSAGE_LOCATION_SEND_SUCCESS:null,MESSAGE_LOCATION_SEND_FAIL:null,FAVORITE_PLACES_REQUEST:null,FAVORITE_PLACES_REQUEST_SUCCESS:null,FAVORITE_PLACES_REQUEST_FAIL:null,GEO_SEARCH_REQUEST:null,GEO_SEARCH_REQUEST_SUCCESS:null,GEO_SEARCH_REQUEST_FAIL:null,CHANNELS_REMOVE_REQUEST:null,CHANNELS_REMOVE_REQUEST_FAIL:null,CHANNELS_REMOVE_REQUEST_SUCCESS:null,CHANNELS_UPDATE_TAGS_REQUEST:null,CHANNELS_UPDATE_TAGS_REQUEST_FAIL:null,CHANNELS_UPDATE_TAGS_REQUEST_SUCCESS:null,CHANNELS_SET_COUNTERS:null,AUTO_REPLIES_REQUEST:null,AUTO_REPLIES_REQUEST_FAIL:null,AUTO_REPLIES_REQUEST_SUCCESS:null,SEARCH_REQUEST:null,SEARCH_REQUEST_FAIL:null,SEARCH_REQUEST_SUCCESS:null,NOTIFICATION_SHOW:null,NOTIFICATION_HIDE:null,LIQUIDITY_REQUEST:null,LIQUIDITY_REQUEST_FAIL:null,LIQUIDITY_REQUEST_SUCCESS:null,FILTER_ITEMS_REQUEST:null,FILTER_ITEMS_REQUEST_FAIL:null,FILTER_ITEMS_REQUEST_SUCCESS:null,FILTER_ITEMS_RESET:null,FILTER_ITEMS_EXACT_REQUEST:null,FILTER_ITEMS_EXACT_REQUEST_FAIL:null,FILTER_ITEMS_EXACT_REQUEST_SUCCESS:null,REVIEW_REQUEST:null,REVIEW_REQUEST_FAIL:null,REVIEW_REQUEST_SUCCESS:null,SPAM_UNBLOCK_REQUEST:null,SPAM_UNBLOCK_REQUEST_FAIL:null,SPAM_UNBLOCK_REQUEST_SUCCESS:null,SETTINGS_REQUEST:null,SETTINGS_REQUEST_FAIL:null,SETTINGS_REQUEST_SUCCESS:null,PUSH_RESET:null}),i=function(e){return function(){return e.apply(void 0,arguments)}};t.a=s},4188:function(e,t,n){"use strict";t.a=function(e){var t,n={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n}},4195:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=["code","message"];function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var i={INTERNAL_ERROR:-32603,INVALID_REQUEST:-32600,METHOD_NOT_FOUND:-32601,INVALID_PARAMS:-32602,PARSE_ERROR:-32700,SOCKET_RECONNECT:-32800,NOT_FOUND:-32044,NOT_AUTHORIZED:-32041,FORBIDDEN:-32043,BAD_REQUEST:-32040,TOO_MANY_REQUESTS:-32249,SERVER_ERROR:-32050,REQUEST_TIMEOUT:-32054,MESSAGE_LOG_GONE:-32140,CLOSE_NORMAL:"close_normal"},o=401,a=function(e){return Object.keys(i).find((function(t){return i[t]===e}))||"UNKNOWN_ERROR"};function u(e){var t=e.code,n=e.message,i=babelHelpers.objectWithoutProperties(e,r),o=new Error(n);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({code:t,type:a(t),message:o.message,stack:o.stack},i)}u.ERROR_CODES=i,t.c=u},4202:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function e(){var t=this;babelHelpers.classCallCheck(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}},4203:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return a}));var r="messenger_folders",s=function(e){return"messenger_folders"===e},i=function(){return!0},o="messenger_fallback",a=function(e){return"messenger_fallback"===e}},4204:function(e,t,n){"use strict";n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return h})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return v})),n.d(t,"a",(function(){return E})),n.d(t,"b",(function(){return m}));var r=n(3956),s=n.n(r),i=n(10678);var o,a,u,c=(o=new Date,a=/\(MSK\)$/.test(o.toString()),u=-o.getTimezoneOffset()/60,a&&3!==u?36e5*(3-u):0);function l(e){return e+"#"+Date.now()}function d(){try{var e=window.localStorage.getItem("messenger:settings");return JSON.parse(e)||{}}catch(e){return{}}}function f(){var e=s.a.get("userSettingsUniqueKey");return d()[e]||{}}function h(e){var t=d();t[s.a.get("userSettingsUniqueKey")]=e;try{window.localStorage.setItem("messenger:settings",JSON.stringify(t))}catch(e){}}function p(){return 1e4*new Date(Date.now()-i.a.session.timeCorrectionOffset).getTime()}function v(){return Date.now()+c}function E(e){if("undefined"!=typeof window&&window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.value=e,t.setAttribute("type","hidden"),t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return!1}finally{setTimeout((function(){return document.body.removeChild(t)}),0)}}}function m(e,t){for(;t;){if(e(t))return t;t=t.parentNode}return null}},4205:function(e,t,n){"use strict";n.d(t,"b",(function(){return p}));var r,s,i=n(3956),o=n.n(i),a=n(4206),u=n(4207),c=a.a.MOBILE,l=a.a.MINI,d=a.a.DESKTOP,f=(r={},babelHelpers.defineProperty(r,c,"mav"),babelHelpers.defineProperty(r,l,"mini-messenger"),babelHelpers.defineProperty(r,d,"messenger"),r),h=(s={},babelHelpers.defineProperty(s,u.e,"inbox"),babelHelpers.defineProperty(s,u.b,"bargainAndExchange"),s);function p(){try{return o.a.get("sendClickstreamEvent").apply(void 0,arguments)}catch(e){return null}}t.a={phoneCall:function(e){return p(2472,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:6})},phoneCallReplyTime:function(e){return p(2474,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:4})},phoneShowNumber:function(e){return p(2486,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:5})},phoneShowNumberReplyTime:function(e){return p(2487,{uid:e.userId,iid:e.itemId,chatid:e.channelId,version:4})},sendMessage:function(e){return p(3176,{uid:e.userId,chatid:e.channelId,message_type:e.messageType,s:e.source,version:3})},channelShow:function(e){var t=e.userId;return p(2919,{chatid:e.channelId,uid:t,s:e.source,channel_number:e.channelNumber,mid:e.searchMsgId,msg_search_query:e.searchQuery,from_page:e.fromPage,version:5})},channelsShow:function(e){return p(2920,{uid:e.userId,from_page:e.fromPage,s:e.source,channels_screen_count:e.channelsScreenCount,version:3})},showConfirmPhoneCodeScreen:function(e){return p(2077,{phone:e,s:"msg_phone_confirm",version:3})},geoAttachmentClick:function(e){var t=e.userId,n=e.channelId,r=e.itemId,s=e.appName;return p(3110,{uid:t,chatid:n,msg_app_name:f[s],iid:r,version:4})},searchLocation:function(e){var t=e.userId,n=e.channelId,r=e.isEdit,s=e.appName;return p(3327,{uid:t,chatid:n,msg_app_name:f[s],s:r?"geo_edit":"geo_search",version:1})},geoSuggestionClick:function(e){var t=e.userId,n=e.channelId,r=e.suggestionType,s=e.appName;return p(3328,{uid:t,chatid:n,msg_app_name:f[s],search_address_type:r,version:2})},detectLocationClick:function(e){var t=e.userId,n=e.channelId,r=e.appName;return p(3326,{uid:t,msg_app_name:f[r],chatid:n,version:2})},attachmentsClick:function(e){var t=e.userId,n=e.channelId,r=e.appName;return p(3109,{uid:t,msg_app_name:f[r],chatid:n,version:2})},profileClick:function(e){var t=e.userId,n=e.channelId,r=e.appName,s=e.itemId,i=e.itemOwnerId,o=e.profileUserId;return p(2998,{uid:t,s:"messenger_chat_menu",msg_app_name:f[r],chatid:n,oid:i,iid:s,puid:o,version:3})},messageCopy:function(e){var t=e.userId,n=e.channelId,r=e.appName,s=e.messageId,i=e.copyText,o=e.isTextWrappedByChecker;return p(3450,{uid:t,msg_app_name:f[r],chatid:n,msg_copy_text:i,mid:s,msg_copy_link_checker:o,version:3})},channelsFilterByMyItems:function(e){return p(2686,{uid:e,version:4})},channelsFilterByItem:function(e){return p(2687,{uid:e,version:2})},channelsFilterByText:function(e){return p(2688,{uid:e,version:2})},channelsFilterByUnread:function(e){return p(2689,{uid:e,version:3})},itemNavigate:function(e){return p(3130,{uid:e.userId,chatid:e.channelId,version:1})},messageTypingStart:function(e){return p(3129,{uid:e.userId,chatid:e.channelId})},resendMessage:function(e){return p(3177,{uid:e.userId,chatid:e.channelId,msg_random_id:e.randomId,message_type:e.messageType,version:1})},sendMessageRequest:function(e){var t=e.userId,n=e.channelId,r=e.network;return p(3477,{uid:t,chatid:n,message_type:e.messageType,msg_random_id:e.randomId,msg_socket_type:e.transport,network_type:r})},deleteMessage:function(e){return p(3218,{uid:e.userId,chatid:e.channelId,msg_random_id:e.randomId,message_type:e.messageType,version:2})},enterButtonClick:function(e,t){return p(3184,{uid:e,s:t})},showConfirmPhoneStartScreen:function(e){return p(3312,{uid:e})},showConfirmPhoneInputScreen:function(e){return p(3313,{uid:e})},platformButtonClick:function(e){var t=e.userId,n=e.messageId;return p(3439,{uid:t,chatid:e.channelId,mid:n,flow_id:e.flowId,msg_button_type:e.buttonType,action_payload:e.actionPayload,version:4})},blockButtonClick:function(e){return p(3464,{uid:e.userId,chatid:e.channelId})},complainButtonClick:function(e){return p(3465,{uid:e.userId,chatid:e.channelId})},suspectMessageDialogShow:function(e){return p(3499,{uid:e.userId,chatid:e.channelId,mid:e.messageId})},channelWithDraftOpen:function(e){return p(3554,{uid:e.userId,chatid:e.channelId})},searchFieldFocus:function(e){return p(3528,{uid:e.userId,version:0})},search:function(e){return p(3529,{uid:e.userId,msg_search_query:e.query,version:1})},showFoundedMsg:function(e){var t=e.userId,n=e.channelId,r=e.searchMsgId,s=e.searchQuery,i=e.chatPageNumber;return p(3532,{uid:t,chatid:n,mid:r,msg_search_success:e.isSuccessful,msg_chat_page_num:i,msg_search_query:s})},showProStats:function(e){return p(4072,{uid:e.userId})},recommendationsClick:function(e){return p(3563,{uid:e.userId,chatid:e.channelId,iid:e.itemId})},browserSearchActivated:function(e){return p(4036,{uid:e.userId,ref:window.location.href})},linkClick:function(e){return p(4170,{uid:e.userId,mid:e.messageId,chatid:e.channelId,msg_link_text:e.linkAddress,version:1})},openFolder:function(e){var t=e.userId,n=e.folder;return p(4275,{uid:t,folder_name:h[n]})},filterExchangeChats:function(e){return p(4281,{uid:e.userId})},filterBargainChats:function(e){return p(4279,{uid:e.userId})},closeFoldersOnboarding:function(e){return p(4282,{uid:e.userId,messenger_folder_onbording_action_name:e.actionType})},clickFolderLandingLink:function(e){return p(4286,{uid:e.userId})},changeFolder:function(e){var t=e.userId,n=e.channelId,r=e.folder,s=e.tags,i=e.source;return p(4285,{uid:t,chatid:n,folder_name:h[r],tag_name:s.toString(),msg_move_to_folder_from:{chatPage:"c",bulkAction:"gt",chatListPage:"chl"}[i]})},itemChunkClick:function(e){var t=e.userId,n=e.itemId,r=e.channelId,s=e.appName;return p(4270,{uid:t,item_id:n,chatid:r,msg_app_name:f[s]})},requestReviewClick:function(e){return p(4361,{chatid:e.channelId,version:0})},downloadCallsButtonClick:function(){return p(4244)},channelsContextMenuClick:function(e){return p(4379,{uid:e.userId})},channelsContextMenuItemClick:function(e){return p(4380,{uid:e.userId,menu_item:e.menuItem})},changeChatbotSettings:function(e){var t=e.userId,n=e.autoReplyEnabled,r=e.itemEmailEnabled,s=e.addressesEnabled;return p(4381,{uid:t,ns_type:"auto_replies",ns_value:n,ns_channel:[].concat(babelHelpers.toConsumableArray(r?["email"]:[]),babelHelpers.toConsumableArray(s?["extra_email"]:[])).join(",")})},fileUpload:function(e){return p(4844,{uid:e.userId,chatid:e.channelId,msg_file:e.fileId})},fileDownloadClick:function(e){return p(4845,{uid:e.userId,chatid:e.channelId,msg_file:e.fileId})}}},4206:function(e,t,n){"use strict";t.a={DESKTOP:"web",PRO_DESKTOP:"pro-web",MOBILE:"mav",MINI:"mini",MODERATION:"moderation",SUPPORT:"support-web"}},4207:function(e,t,n){"use strict";var r,s;n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return l})),n.d(t,"d",(function(){return d}));var i="f_b",o="f_e",a="s",u="other",c="exb",l=(r={},babelHelpers.defineProperty(r,u,["f_i"]),babelHelpers.defineProperty(r,c,[o,i]),r),d=(s={},babelHelpers.defineProperty(s,u," "),babelHelpers.defineProperty(s,c,"  "),s)},4211:function(e,t,n){"use strict";n.r(t),n.d(t,"setUploadProgress",(function(){return p})),n.d(t,"createFile",(function(){return v})),n.d(t,"uploadImage",(function(){return E})),n.d(t,"uploadFile",(function(){return m}));var r=n(4187),s=n(4204),i=n(3956),o=n.n(i),a=n(4234),u=n(4212),c=n(10678),l=n(4202),d=n(4205),f=n(4235),h=function(e,t,n){var r=new l.a,s=new XMLHttpRequest;return s.open("POST",t),s.withCredentials=!0,s.upload.addEventListener("progress",(function(e){n(e.loaded,e.total)})),s.addEventListener("error",(function(){r.reject("request error")})),s.addEventListener("load",(function(){200!==s.status&&r.reject(s.responseText),s.responseText||r.resolve({result:{ok:!0}});try{var e=JSON.parse(s.responseText);r.resolve(e)}catch(e){r.reject("Response promise parse error")}})),s.send(e),{promise:r.promise,abort:function(){s.abort(),r.reject("abort")}}};function p(e,t,n){return{type:r.a.SET_UPLOAD_PROGRESS,messageId:e,uploadedBytes:t,totalBytes:n}}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e),i=t.get("file");if(!(i&&i instanceof File))throw Error("expected valid file at form data");var o=new u.a({id:n,channelId:e,body:{randomId:n,sizeBytes:i.size,name:i.name}});return{type:r.a.FILE_CREATE,promise:c.a.createFile(e),message:o,formData:t,id:n,radar:!0}}function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e);return function(){var s=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function s(i){var u,c,l,d;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return u=new a.a({id:n,channelId:e,body:{randomId:n}}),c=h(t,o.a.get("imageUploadUrl"),(function(e,t){return i(p(u.id,e,t))})),l=c.promise,d=c.abort,s.abrupt("return",i({channelId:e,formData:t,id:n,type:r.a.IMAGE_UPLOAD,message:u,radar:!0,promise:l,abort:d}));case 3:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(s.c)(e);return function(){var s=babelHelpers.asyncToGenerator(regeneratorRuntime.mark((function s(i,a){var c,l,E,m,g,S,y,b;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if((c=t.get("file"))&&c instanceof File){s.next=3;break}throw Error("expected valid file at form data");case 3:return s.next=5,i(v(e,t,n));case 5:if(!(l=s.sent).isError){s.next=8;break}return s.abrupt("return",l);case 8:return E=l.result.fileId,m=new u.a({id:n,channelId:e,body:{randomId:n,fileId:E,sizeBytes:c.size,name:c.name}}),g=Object(f.g)(a()),d.a.fileUpload({userId:g,channelId:e,fileId:E}),S=h(t,"".concat(o.a.get("fileUploadUrl"),"?id=").concat(E),(function(e,t){return i(p(m.id,e,t))})),y=S.promise,b=S.abort,s.abrupt("return",i({channelId:e,formData:t,id:n,type:r.a.FILE_UPLOAD,message:m,radar:!0,promise:y,abort:b}));case 14:case"end":return s.stop()}}),s)})));return function(e,t){return s.apply(this,arguments)}}()}},4212:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.FILE,r}return n}(r.a)},4213:function(e,t,n){"use strict";var r,s,i,o;n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return o})),function(e){e.SYSTEM="system",e.IMAGE="image",e.TEXT="text",e.ITEM="item",e.CALL="call",e.LINK="link",e.LOCATION="location",e.DELETED="deleted",e.APP_CALL="appCall",e.FILE="file",e.UNKNOWN=""}(r||(r={})),function(e){e.PLATFORM="platform",e.PLATFORM_FROM_USER="platformFromUser",e.REACTION="react"}(s||(s={})),function(e){e.DEFAULT="default",e.TEXT="text",e.GEO="geo_message",e.IMAGE="image",e.ITEM="item"}(i||(i={})),function(e){e[e.SENDING=0]="SENDING",e[e.SENT=1]="SENT",e[e.DELIVERED=2]="DELIVERED",e[e.READ=3]="READ",e[e.FAILED=4]="FAILED"}(o||(o={}))},4214:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(10809),s=n(10678),i=n(4213);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var a=function(){function e(t){babelHelpers.classCallCheck(this,e),this.id="",this.type=i.c.UNKNOWN,this.fromUid=0,this.uid=0,this.created=0,this.channelId="",this.body={},this.isRead=!1,this.isSpam=!1,this.isDeleted=!1,this.checkRequired(t),this.init(t),r.e.deepAssign(this,t)}return babelHelpers.createClass(e,[{key:"checkRequired",value:function(e){if(!(null==e?void 0:e.channelId))throw new Error("channelId isRequired")}},{key:"init",value:function(e){var t,n=e.channelId,r=e.read,o=e.delivered,a=e.fromUid;this.channelId=null!=n?n:this.channelId,this.fromUid=null!==(t=a||s.a.session.userId)&&void 0!==t?t:this.fromUid,this.created=1e4*new Date(Date.now()-s.a.session.timeCorrectionOffset).getTime(),o&&(this.sendingStatus=i.d.DELIVERED),r&&(this.sendingStatus=i.d.READ),this.isMine&&!this.sendingStatus&&(this.sendingStatus=i.d.SENDING)}},{key:"assign",value:function(e){return new(0,this.constructor)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this,{},e))}},{key:"date",get:function(){return new Date(this.created/1e4)}},{key:"isSendingFailed",get:function(){return this.sendingStatus===i.d.FAILED}},{key:"isMine",get:function(){return e.isMine(this.fromUid)}},{key:"isEqual",value:function(t){return t instanceof e&&this.id===t.id&&this.type===t.type&&this.sendingStatus===t.sendingStatus}}],[{key:"isMine",value:function(e){return e===s.a.session.userId}}]),e}()},4234:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.IMAGE,r}return n}(r.a)},4235:function(e,t,n){"use strict";n.d(t,"g",(function(){return s})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return l}));var r=n(4206),s=function(e){var t;return null!==(t=e.system.userId)&&void 0!==t?t:0},i=function(e){return e.system.isConnected},o=function(e){return e.system.isClosed},a=function(e){var t;return null!==(t=e.system.appName)&&void 0!==t?t:r.a.DESKTOP},u=function(e){return e.system.appVersion},c=function(e){return e.system.appName===r.a.PRO_DESKTOP},l=function(e){return e.system.isAuthorized}},4236:function(e,t,n){"use strict";n.d(t,"f",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"b",(function(){return d}));var r=n(4206),s=n(4237),i=n(4235),o=function(e){return e.messages.list||[]},a=function(e){return o(e).some((function(e){return e.isSpam}))},u=function(e){var t=o(e),n=Object(i.g)(e);return t.some((function(e){return e.fromUid!==n}))},c=function(e){return e.messages.channelId},l=function(e,t){return o(e).find((function(e){return e.id===t}))},d=function(e){var t=Object(i.g)(e),n=Object(s.c)(e),a="item"===(null==n?void 0:n.type)?n.value.userId:void 0,u=o(e),c=a===t,l="item"===(null==n?void 0:n.type)?n.value.replyTime:void 0,d=e.messages.fetching,f=e.system.appName===r.a.SUPPORT||e.system.appName===r.a.MODERATION;return!(0!==u.length||c||d||f)&&Boolean(l)}},4237:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"g",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l}));var r=n(10971),s=function(e){var t;return null===(t=e.channel)||void 0===t?void 0:t.channel},i=function(e){var t,n=s(e),r=null==n?void 0:n.inputState;return r?r.description:null==n||null===(t=n.readOnly)||void 0===t?void 0:t.description},o=function(e){var t=s(e),n=null==t?void 0:t.inputState;return n?n.isDisabled:Boolean(null==t?void 0:t.readOnly)},a=function(e){var t=s(e);return null==t?void 0:t.context},u=function(e){var t=s(e);return null==t?void 0:t.channelId},c=function(e){var t,n=s(e);if(Object(r.h)(n))return null===(t=n.context)||void 0===t?void 0:t.value.id},l=function(e){var t,n=s(e);if(Object(r.h)(n))return null===(t=n.context)||void 0===t?void 0:t.value.priceString}},4238:function(e,t,n){var r=n(4167),s=n(4239),i=n(4174),o=n(4186),a=i((function(e,t){if(null==e)return[];var n=t.length;return n>1&&o(e,t[0],t[1])?t=[]:n>2&&o(t[0],t[1],t[2])&&(t=[t[0]]),s(e,r(t,1),[])}));e.exports=a},4239:function(e,t,n){var r=n(4156),s=n(4148),i=n(4128),o=n(4240),a=n(4244),u=n(4052),c=n(4245),l=n(3967),d=n(4004);e.exports=function(e,t,n){t=t.length?r(t,(function(e){return d(e)?function(t){return s(t,1===e.length?e[0]:e)}:e})):[l];var f=-1;t=r(t,u(i));var h=o(e,(function(e,n,s){return{criteria:r(t,(function(t){return t(e)})),index:++f,value:e}}));return a(h,(function(e,t){return c(e,t,n)}))}},4240:function(e,t,n){var r=n(4241),s=n(4058);e.exports=function(e,t){var n=-1,i=s(e)?Array(e.length):[];return r(e,(function(e,r,s){i[++n]=t(e,r,s)})),i}},4241:function(e,t,n){var r=n(4242),s=n(4243)(r);e.exports=s},4242:function(e,t,n){var r=n(4178),s=n(4041);e.exports=function(e,t){return e&&r(e,t,s)}},4243:function(e,t,n){var r=n(4058);e.exports=function(e,t){return function(n,s){if(null==n)return n;if(!r(n))return e(n,s);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&!1!==s(a[o],o,a););return n}}},4244:function(e,t){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},4245:function(e,t,n){var r=n(4246);e.exports=function(e,t,n){for(var s=-1,i=e.criteria,o=t.criteria,a=i.length,u=n.length;++s<a;){var c=r(i[s],o[s]);if(c)return s>=u?c:c*("desc"==n[s]?-1:1)}return e.index-t.index}},4246:function(e,t,n){var r=n(4035);e.exports=function(e,t){if(e!==t){var n=void 0!==e,s=null===e,i=e==e,o=r(e),a=void 0!==t,u=null===t,c=t==t,l=r(t);if(!u&&!l&&!o&&e>t||o&&a&&c&&!u&&!l||s&&a&&c||!n&&c||!i)return 1;if(!s&&!o&&!l&&e<t||l&&n&&i&&!s&&!o||u&&n&&i||!a&&i||!c)return-1}return 0}},4247:function(e,t,n){var r=n(4156),s=n(4248),i=n(4128),o=n(4174),a=n(4250),u=n(4199),c=o((function(e){var t=u(e),n=r(e,a);return t===u(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?s(n,i(t,2)):[]}));e.exports=c},4248:function(e,t,n){var r=n(4134),s=n(4019),i=n(4249),o=n(4156),a=n(4052),u=n(4138),c=Math.min;e.exports=function(e,t,n){for(var l=n?i:s,d=e[0].length,f=e.length,h=f,p=Array(f),v=1/0,E=[];h--;){var m=e[h];h&&t&&(m=o(m,a(t))),v=c(m.length,v),p[h]=!n&&(t||d>=120&&m.length>=120)?new r(h&&m):void 0}m=e[0];var g=-1,S=p[0];e:for(;++g<d&&E.length<v;){var y=m[g],b=t?t(y):y;if(y=n||0!==y?y:0,!(S?u(S,b):l(E,b,n))){for(h=f;--h;){var I=p[h];if(!(I?u(I,b):l(e[h],b,n)))continue e}S&&S.push(b),E.push(y)}}return E}},4249:function(e,t){e.exports=function(e,t,n){for(var r=-1,s=null==e?0:e.length;++r<s;)if(n(t,e[r]))return!0;return!1}},4250:function(e,t,n){var r=n(4181);e.exports=function(e){return r(e)?e:[]}},4251:function(e,t,n){var r=n(4156),s=n(4248),i=n(4174),o=n(4250),a=i((function(e){var t=r(e,o);return t.length&&t[0]===e[0]?s(t):[]}));e.exports=a},4252:function(e,t,n){var r=n(4039),s=n(4253)((function(e,t,n){r(e,n,t)}));e.exports=s},4253:function(e,t,n){var r=n(4254),s=n(4255),i=n(4128),o=n(4004);e.exports=function(e,t){return function(n,a){var u=o(n)?r:s,c=t?t():{};return u(n,e,i(a,2),c)}}},4254:function(e,t){e.exports=function(e,t,n,r){for(var s=-1,i=null==e?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r}},4255:function(e,t,n){var r=n(4241);e.exports=function(e,t,n,s){return r(e,(function(e,r,i){t(s,e,n(e),i)})),s}},4256:function(e,t){e.exports=function(e){return null==e}},4257:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.TEXT,r}return babelHelpers.createClass(n,[{key:"checkRequired",value:function(e){var t;if(!(null==e||null===(t=e.body)||void 0===t?void 0:t.text))throw new Error("body.text isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"checkRequired",this).call(this,e)}}]),n}(r.a)},4258:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.ITEM,r}return babelHelpers.createClass(n,[{key:"checkRequired",value:function(e){if(!e||!e.body||!e.body.itemId)throw new Error("body.itemId isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"checkRequired",this).call(this,e)}}]),n}(r.a)},4259:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.LINK,r}return babelHelpers.createClass(n,[{key:"checkRequired",value:function(e){var t;if(!(null==e||null===(t=e.body)||void 0===t?void 0:t.url))throw new Error("body.url isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"checkRequired",this).call(this,e)}}]),n}(r.a)},4260:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.LOCATION,r}return babelHelpers.createClass(n,[{key:"checkRequired",value:function(e){var t,r;if("number"!=typeof(null==e||null===(t=e.body)||void 0===t?void 0:t.lat)||"number"!=typeof(null==e||null===(r=e.body)||void 0===r?void 0:r.lon))throw new Error("body.lat and body.lon are required");babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"checkRequired",this).call(this,e)}}]),n}(r.a)},4303:function(e,t,n){var r=n(4304),s=n(4041);e.exports=function(e){return null==e?[]:r(e,s(e))}},4304:function(e,t,n){var r=n(4156);e.exports=function(e,t){return r(t,(function(t){return e[t]}))}},4305:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r,s=n(4303),i=n.n(s);!function(e){e.ANY="any",e.URL="url",e.DELIMITER="delimiter"}(r||(r={}));var o=function e(t){var n=t.text,s=t.type;if(babelHelpers.classCallCheck(this,e),!i()(r).includes(s))throw new Error("type is incorrect");this.text=n,this.type=s}},4306:function(e,t,n){"use strict";function r(e){var t="https://link.avito.ru/go?to=",n=0===e.indexOf(t);return!e||n?e:"".concat(t).concat(encodeURIComponent(e))}function s(e){if(!e)return e;var t=e.toLowerCase();return 0===t.indexOf("http://")||0===t.indexOf("https://")||0===t.indexOf("//")||0===e.indexOf("/")?e:"https://".concat(e)}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return s}))},4307:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return a}));var r=3e3,s=2e3,i={JOB_VACANCY:111,JOB_RESUME:112},o="  ",a="blacklist"},4308:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var r=n(4188),s=n(10779),i={CHANNEL_DELETE:"ru.avito://1/channel/delete",CHANNEL_COMPLAIN:"ru.avito://1/channel/blockWithReason",CHANNEL_BLOCK:"ru.avito://1/channel/block",CHANNEL_CALL:"ru.avito://1/channel/call",CHANNEL_CHANGE_FOLDER:"ru.avito://1/channel/changeFolder",CHANNEL_REVIEW:"ru.avito://1/channel/review",ABUSE:"ru.avito://1/abuse/report",HELP_CENTER_SHOW:"ru.avito://1/helpcenter/show"},o=Object(r.a)(i),a=function(e){var t,n=Object.entries(i).find((function(n){var r=babelHelpers.slicedToArray(n,2),i=(r[0],r[1]),o=e.split("?"),a=babelHelpers.slicedToArray(o,2),u=a[0],c=a[1],l=void 0===c?"":c;return u===i&&(t=Object(s.queryStringToObject)(l),!0)}))||[],r=babelHelpers.slicedToArray(n,1)[0];return{query:t,route:r}}},4309:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4214),s=n(4213);function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=babelHelpers.getPrototypeOf(e);if(t){var s=babelHelpers.getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return babelHelpers.possibleConstructorReturn(this,n)}}var o=function(e){babelHelpers.inherits(n,e);var t=i(n);function n(e){var r;return babelHelpers.classCallCheck(this,n),(r=t.call(this,e)).type=s.c.TEXT,r}return babelHelpers.createClass(n,[{key:"checkRequired",value:function(e){var t;if(!(null==e||null===(t=e.body)||void 0===t?void 0:t.text))throw new Error("body.text isRequired");babelHelpers.get(babelHelpers.getPrototypeOf(n.prototype),"checkRequired",this).call(this,e)}}]),n}(r.a)},4326:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return a}));var r="msgr:inited";function s(e){return function(){for(var t,n,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];if(null===(t=window.avito)||void 0===t||null===(n=t.messenger)||void 0===n?void 0:n.helpers){var a,u;null===(a=(u=window.avito.messenger.helpers)[e])||void 0===a||a.call.apply(a,[u].concat(i))}else{var c=function t(){var n,s,o,a;null===(n=window.avito)||void 0===n||null===(s=n.messenger)||void 0===s||null===(o=s.helpers)||void 0===o||null===(a=o[e])||void 0===a||a.call.apply(a,[o].concat(i)),document.removeEventListener(r,t)};document.addEventListener(r,c)}}}var i=s("openChannel"),o=s("verifyPhone"),a=s("setDraftMessage");s("refetchChannels")},4338:function(e,t,n){var r=n(4167),s=n(4128),i=n(4174),o=n(4339),a=n(4181),u=n(4199),c=i((function(e){var t=u(e);return a(t)&&(t=void 0),o(r(e,1,a,!0),s(t,2))}));e.exports=c},4339:function(e,t,n){var r=n(4134),s=n(4019),i=n(4249),o=n(4138),a=n(4340),u=n(4141);e.exports=function(e,t,n){var c=-1,l=s,d=e.length,f=!0,h=[],p=h;if(n)f=!1,l=i;else if(d>=200){var v=t?null:a(e);if(v)return u(v);f=!1,l=o,p=new r}else p=t?[]:h;e:for(;++c<d;){var E=e[c],m=t?t(E):E;if(E=n||0!==E?E:0,f&&m==m){for(var g=p.length;g--;)if(p[g]===m)continue e;t&&p.push(m),h.push(E)}else l(p,m,n)||(p!==h&&p.push(m),h.push(E))}return h}},4340:function(e,t,n){var r=n(4109),s=n(3999),i=n(4141),o=r&&1/i(new r([,-0]))[1]==1/0?function(e){return new r(e)}:s;e.exports=o},4357:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(4187),s=n(4338),i=n.n(s),o=n(10971);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c={hash:{},emptyChannels:[]};function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.a.SET_DRAFT_MESSAGES:var n=t.draftMessages,s=n.hash,a=void 0===s?{}:s,l=n.emptyChannels,d=void 0===l?[]:l;return{hash:a,emptyChannels:Object(o.a)(d)};case r.a.MESSAGE_DRAFT:var f=t.text,h=t.channelId,p=t.interlocutorId;return u({},e,{hash:u({},e.hash,babelHelpers.defineProperty({},h,f?{text:String(f),userId:Number(p)}:void 0))});case r.a.MESSAGE_SEND:var v=t.channelId;return u({},e,{hash:u({},e.hash,babelHelpers.defineProperty({},v,void 0))});case r.a.CHANNEL_REQUEST_SUCCESS:var E=t.channel,m=Boolean(E.lastMessage),g=Boolean(e.emptyChannels.find((function(e){return e.channelId===E.channelId}))),S=babelHelpers.toConsumableArray(e.emptyChannels);return m?g&&(S=e.emptyChannels.filter((function(e){return e.channelId!==E.channelId}))):S=i()([E],e.emptyChannels,"channelId"),u({},e,{emptyChannels:S,hash:u({},e.hash,babelHelpers.defineProperty({},E.channelId,E.readOnly?void 0:e.hash[E.channelId]))});case r.a.CHANNELS_REMOVE_REQUEST_SUCCESS:var y=t.channelIds.reduce((function(e,t){return e[t]=void 0,e}),{}),b=e.emptyChannels.filter((function(e){return!t.channelIds.includes(e.channelId)}));return u({},e,{hash:u({},e.hash,{},y),emptyChannels:b});case r.a.BLACKLIST_ADD_USERS_REQUEST_SUCCESS:var I=[],T=Object.entries(e.hash).reduce((function(e,n){var r=babelHelpers.slicedToArray(n,2),s=r[0],i=r[1],o=(i=void 0===i?{}:i).userId,a=void 0===o?0:o;return t.users.forEach((function(t){var n=t.itemId,r=t.userId;I.push(n),a===r&&(e[s]=void 0)})),e}),u({},e.hash)),_=e.emptyChannels.filter((function(e){var t,n=Object(o.h)(e)&&(null===(t=e.context)||void 0===t?void 0:t.value.id)||0;return!I.includes(n)}));return u({},e,{hash:T,emptyChannels:_});case r.a.EVENTS_BLACKLIST_ADDED:var C,O,R,w,A,k=null===(C=t.response)||void 0===C?void 0:C.userId,L=null===(O=t.response)||void 0===O||null===(R=O.context)||void 0===R?void 0:R.itemId,M=null===(w=t.response)||void 0===w||null===(A=w.context)||void 0===A?void 0:A.channelId,P=Object.entries(e.hash).reduce((function(e,t){var n=babelHelpers.slicedToArray(t,2),r=n[0],s=n[1],i=(s=void 0===s?{}:s).userId;return(void 0===i?0:i)===k&&(e[r]=void 0),e}),u({},e.hash));return u({},e,{hash:P,emptyChannels:e.emptyChannels.filter((function(e){var t,n,r=e.users.find((function(e){return e.id===k})),s=L&&Object(o.h)(e)&&(null===(t=e.context)||void 0===t||null===(n=t.value)||void 0===n?void 0:n.id)===L,i=M&&e.channelId===M;return!r||!s&&!i}))});default:return e}}}}]);
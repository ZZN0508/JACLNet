define(["./ad_s","./storage","./sg","local/common/components/nsglibCommon","local/desktop/phx/layer"],function(e,t,n,o,r){var i=!1,a=12e4,u=12e4;return{run:function(){if(!0===i)return;if(i=!0,o.phxLayer.layerIsStatic())return;try{document.hasFocus()}catch(e){return}function s(e,t,n){var o=1;function r(r){var i,a=new Image;a.onload=r.ok,a.src=(i=e+n(o),o++,i),setTimeout(r.error,t)}return{test:function(e){var t=!1;function n(n){return function(){!0!==t&&(t=!0,e(n))}}r({ok:n(!0),error:n(!1)})}}}setTimeout(function(){try{n.wasAutorefresh()&&e.setEventStats("vidEvent","action","sg_autorefresh",0,0)}catch(e){}},3e3);var c=function(){var e=s("https://ocdn.eu/images/pulscms/N2U7MDA_/55fade2068e7503eae8d7ddf5eb6bd09.gif",2e3,function(){return"?antycache="+(+new Date+"").substr(0,9)});return function(){return e}}(),d=new Date,m=d,f=1,l=0,v=0,g=!0,h=function(e){try{(e.pageX-l)*(e.pageX-l)+(e.pageY-v)*(e.pageY-v)>10&&(l=e.pageX,v=e.pageY,d=new Date,g&&(g=!1,o.domBuilder.removeEvent(document,"mousemove",h),setTimeout(function(){g=!0,o.domBuilder.addEvent(document,"mousemove",h)},5e3)))}catch(e){}};function p(){d=new Date}o.domBuilder.addEvent(document,"mousemove",h),o.domBuilder.addEvent(document,"keydown",p),o.domBuilder.addEvent(document,"click",p),o.domBuilder.addEvent(document,"touchend",p);var w=function(e){if(!1===n.isAllowAutorefresh()||!0===(o.phxLayer.layerIsOpened()||o.phxLayer.layerIsStatic()))return!1;var r=function(e){var t=window.pageYOffset||document.documentElement.scrollTop,n=window.innerHeight||document.documentElement.clientHeight,o={visibleBegin:t,visibleEnd:t+n};o.visibleBegin>e?o.visibleBegin-=e:o.visibleBegin=0;return o.visibleEnd+=e,o}(0);r.visibleBegin&&r.visibleBegin>6500||c().test(function(n){!0===n&&(t.set("sg.autorefresh.time2",+new Date),t.set("sg.autorefresh.type",e.refreshType),window.location.reload())})};setInterval(function(){var e=document.hasFocus(),t=new Date;e?(t.getTime()-a>d.getTime()?(w({refreshType:"wasFocus"}),d=t):t.getTime()-u>Math.max(m,r.getCloseTime())&&w({refreshType:"refreshAfterBack"}),m=t,f=1):(d=t,t.getTime()-u*f>m&&f++)},3e3)}}});
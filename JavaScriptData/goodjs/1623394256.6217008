YUI.add("af-rapid",function(t,e){"use strict";var i={rapidInstance:null,moduleQueue:[],addModules:function(t){this.moduleQueue.push(t)}},a=t.Lang,n=t.Af.Utils;function r(e){var r,s="afRapid";n.perfStart(s),(e=e||{}).i13nConfig=e.i13nConfig||{},window.YAHOO=window.YAHOO||{},window.YAHOO.i13n=window.YAHOO.i13n||{},window.YAHOO.i13n=t.merge(window.YAHOO.i13n,e.i13nConfig.ywaMaps);try{t.rapid&&a.isFunction(t.rapid.initRapid)?this.tracker=t.rapid:(r=t.merge(i,{rapidConfig:e.i13nConfig.rapid||{}}),e.i13nConfig.rapidInstance&&(r.instance=e.i13nConfig.rapidInstance),this.tracker=new t.Media.RapidTracking(r),this.tracker.initRapid()),this._initAppletListeners()}catch(c){}t.Af.rapid=this,n.perfStop(s)}r.prototype={initializer:function(){this._initSelectBoxListeners()},getRapidTracker:function(){return this.tracker},_initAppletListeners:function(){a.isFunction(this.after)&&(this.after(["*:viewrender","*:viewupdate","*:appletinit"],function(t){this._addOrRefresh(t.applet.guid)},this),this.after("*:viewdisplay",function(t){null===t.viewdisplay.prevRegion&&t.viewdisplay.newRegion&&this._addOrRefresh(t.applet.guid)},this),this.after("*:appletremove",function(t){this.tracker&&this.tracker.removeModule("applet_"+t.applet.guid)},this))},_autoBeacon:function(t){var e,i=t.ancestor("[data-i13n]",!0);return!i||!(e=this._parseDataAttr(i,"i13n"))||"false"!==e.auto},_addOrRefresh:function(e){if(this.tracker){var i,a,n,r,s,c="applet_"+e,o=t.Af.Bootstrap.getMeta(e),l=o&&o.i13n,p=l&&l.pv;l&&l.pp&&(s={pp:l.pp}),this.tracker.isModuleTracked(c)?this.tracker.refreshModule(c,p,!0,s):(i=t.one("#"+c),this._autoBeacon(i)&&(!(n=l&&l.sec)&&i&&(i&&(a=this._parseDataAttr(i,"i13n")),n=a.sec||i.getData("i13n-sec"),i&&a&&(!0===a.useViewability||"true"===a.useViewability)&&(s?s.useViewability=!0:s={useViewability:!0})),n?((r={})[c]=n,this.tracker.addModules(r,p,s),i.hasAttribute("data-i13n-secvw")&&this.tracker.beaconEvent("secvw",{sec:n},"")):this.tracker.addModules([c],p,s)))}},_parseDataAttr:function(e,i){return e?t.Af.Utils.stringParseKV(e.getData(i)):{}},_getSelectBoxSelectedLinkName:function(t,e){var i=t.get("value"),a=t.all("option").item(t.get("selectedIndex"));return this._parseDataAttr(a,"i13n-ylk")[e]||i},_getSelectBoxName:function(t,e){return this._parseDataAttr(t,"i13n-ylk")[e]||t.get("name")},_initSelectBoxListeners:function(){if(!(t.UA.ie&&t.UA.ie<9)){var e,i=t.one("body"),a="select";i.delegate("mousedown",function(i){if("SELECT"===i.target.get("tagName")&&this._autoBeacon(i.target)){var a={slk:this._getSelectBoxSelectedLinkName(i.target,"slk"),elm:"inpt",elmt:"mu",itc:1,t3:this._getSelectBoxName(i.target,"t3")};t.UA.ie?e=t.later(250,this,function(){e=null,this.triggerBeaconClickEvent(i.target,a)}):this.triggerBeaconClickEvent(i.target,a)}},a,this),i.delegate("keyup",function(t){if(this._autoBeacon(t.target)&&9===t.keyCode){var e={slk:this._getSelectBoxSelectedLinkName(t.target,"slk"),elm:"inpt",elmt:"muk",itc:1,t3:this._getSelectBoxName(t.target,"t3")};this.triggerBeaconClickEvent(t.target,e)}},a,this),i.delegate("change",function(i){if(this._autoBeacon(i.target)){var a={slk:this._getSelectBoxSelectedLinkName(i.target,"slk"),elm:"itm",elmt:"slct",itc:1,t3:this._getSelectBoxName(i.target,"t3")};t.UA.ie?(e&&(e.cancel(),e=null),this.triggerBeaconClickEvent(i.target,a)):this.triggerBeaconClickEvent(i.target,a)}},a,this)}},getSecValue:function(t){var e=t.ancestor("[data-i13n],[data-i13n-sec],[data-applet-type]",!0),i="";return e&&(i=this._parseDataAttr(e,"i13n").sec||e.getData("i13n-sec")||e.getData("applet-type")),i},getSlkValue:function(t){var e=t.getDOMNode(),i="";return e&&(i=(i=e.textContent||e.innerText||"").substring(0,299)),i},parseYLK:function(e){var i=e?this._parseDataAttr(e,"ylk"):{},a=e.ancestor("[data-applet-type][data-ylk]",!0,"[data-applet-type]");return a?t.merge(this._parseDataAttr(a,"ylk"),i):i},triggerBeaconClickEvent:function(e,i,n,r){if(e){var s,c,o,l,p,u,d={};(d=this.parseYLK(e)).sec||(p=this.getSecValue(e))&&(d.sec=p),d.slk||(u=this.getSlkValue(e))&&(d.slk=u),i&&(d=t.merge(d,i)),d.sec?(s=d.sec,delete d.sec,c=d.slk||"",delete d.slk,o=parseInt(d.pos,10),a.isNumber(o)||(o=1),l=e.getData("action-outcome"),this.tracker.beaconClick(s,c,o,d,l,n,r)):n&&n()}else n&&n()}},t.namespace("Af").Rapid=r},"@VERSION@",{requires:["af-bootstrap","af-utils","media-rapid-tracking","node-core"]});
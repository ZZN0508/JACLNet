YUI.add("tdapi-remotestore",function(t,e){"use strict";var n,o=["resource","operation","params","body"],c="/_td_api",r="read",i=t.Object,a=t.Array,u=t.Lang,s=t.Mjata,f=s.REST.HTTP,l=t.Af.Utils;function g(e){if(e&&e.responseText)try{return t.JSON.parse(e.responseText)}catch(n){return null}return null}function p(e){return u.isArray(e)||u.isObject(e)?t.JSON.stringify(e):e}function h(t,e){var n=[],o=t;return i.each(e.context,function(t,e){n.push(e+"="+encodeURIComponent(t))}),n.length>0&&(o+="?"+n.sort().join("&")),o}n={_constructGetUri:function(t,e,n,o){var c,r=[],a=[],u=o.config.id_param,s=t+"/resource/"+e;return i.each(n,function(t,e){if(e===u)c=encodeURIComponent(t);else try{a.push(e+"="+encodeURIComponent(p(t)))}catch(n){}}),i.each(o.context,function(t,e){("crumb"!==e||o.config.crumbForGET)&&r.push(e+"="+encodeURIComponent(p(t)))}),o.config.enableEdgePipeFallback&&(r.push("enable_edgepipe_fallback=1"),r.push("_enable_edgepipe=1")),c&&(s+="/"+u+"/"+c),a.length>0&&(s+=";"+a.sort().join(";")),r.length>0&&(s+="?"+r.sort().join("&")),s},batch:function(t){if(!u.isArray(t)||t.length<=1)return t;var e,n={};return a.each(t,function(t){var e,o,c;t.context&&t.context.config&&(e=t.context.config.uri||t.context.config.xhr||"",o=t.context.config.batch),c="uri:"+e,o&&(c+=";batch:"+o),n[c]||(n[c]=[]),n[c].push(t)}),(e=i.values(n)).length,t.length,e},single:function(e){if(e){var n,i,a,u,s,p=e.context,x=e.callback||l.noop,m=p.config&&(p.config.uri||p.config.xhr)||c;if(!(r===e.operation||p.context&&p.context.crumb))return x({statusCode:400,statusText:"missing crumb"});(n=e.operation!==r||p.config.post_for_read)||((a=this._constructGetUri(m,e.resource,e.params,p)).length<=2048?m=a:n=!0),n?((u={}).g0=t.mix({},e,!0,o),e.body||delete u.g0.body,s={requests:u,context:p.context},m=h(m,p),i=e.operation===r,f.post(m,{},s,t.merge({unsafeAllowRetry:i},p.config),function(t,e){if(t)return x(t);var n=g(e);n=n&&n.g0||{},x(n.err,n.data)})):f.get(m,{},p.config,function(t,e){if(t)return x(t);x(null,g(e))})}},multi:function(e){var n,u,s,l=0,p=!0,x={};a.some(e,function(t){return!!(t.context&&t.context.context&&t.context.context.crumb)&&(s=t.context,!0)},this),s&&s.context.crumb?(n=s.config&&(s.config.uri||s.config.xhr)||c,u={requests:{},context:s.context},a.each(e,function(e){var n="g"+l++;u.requests[n]=t.mix({},e,!0,o),x[n]=e,e.operation!==r&&(p=!1)}),n=h(n,s),f.post(n,{},u,t.merge({unsafeAllowRetry:p},s.config),function(t,n){if(t)a.each(e,function(e){e.callback(t)});else{var o=g(n);i.each(x,function(t,e){var n=o&&o[e]||{};t.callback&&t.callback(n.err||null,n.data||null)})}})):a.each(e,function(t){t.callback({statusCode:400,statusText:"missing crumb"})})}},t.namespace("TDAPI").RemoteStore=s.createStore("Store.TDAPI",{},n)},"@VERSION@",{requires:["mjata-store","mjata-rest-http","json"]});
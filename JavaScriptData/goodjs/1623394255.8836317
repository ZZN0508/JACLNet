YUI.add("af-applet-init",function(e,t){"use strict";var i=e.Af,a=i.AppletDom,n=i.Utils,p=i.Config,o=e.Lang,s=i.Bootstrap,r=e.Object,l=e.DOM,c=i.Beacon,f="appletinit",d="data-applet-init",u="appletsinit",h="viewport",g="js-appletiniting",w=n.perfStart,v=n.perfStop,y=p.isDev();function A(){this._defInit=p.getContext("default_appletinit")||h}A.prototype={name:"applet.init",execute:function(e,t,i){switch(t.action){case"page.init":this.initApplets(e),e.after("*:initapplet",function(t){var i=t.initapplet;this.initApplet(e,i)},this);break;case"applet.init":this.initApplet(e,t.params)}t.callback&&t.callback(),i()},initApplets:function(t){var i,a,p=this,o=[],c=n.screenTouchable()?"touchstart":"mouseenter";a=this._scan(t),o=(o=(o=o.concat(r.keys(a.now))).concat(r.keys(a.lazy))).concat(r.keys(a.viewport)),s.load(o,{},function(){r.each(a.now,function(i){e.later(5,p,function(){this.initApplet(t,{node:i})})})}),r.each(a.lazy,function(e){e.once(c,function(){this.initApplet(t,{node:e})},this)},this),r.size(a.viewport)&&(r.each(a.viewport,function(e,i){e.once(c,function(){delete a.viewport[i],this.initApplet(t,{node:e})},this)},this),i=e.one(window).after("scroll",n.throttle(function(){var n=l.viewportRegion();r.each(a.viewport,function(i,p){l.inRegion(i.getDOMNode(),n,!1)&&(delete a.viewport[p],e.later(5,this,function(){this.initApplet(t,{node:i})}))},p),i&&0===r.size(a.viewport)&&i.detach()},200))),e.publish(u,{fireOnce:!0,async:!0}),e.fire(u,{applets:t})},_scan:function(t){var i,n=this,p="aptsScanDOM",s={deferred:{},now:{},viewport:{},lazy:{}};return w(p),a.all(e.one("body"),function(e){var p=e.getData(),r=p["applet-defer"],c=p["applet-init"],f=a.getGuid(e);if(!o.isValue(r))switch(c=c||n._defInit){case"critical":n.initApplet(t,{node:e});break;case"now":s.now[f]=e;break;case"lazy":s.lazy[f]=e;break;case h:i=i||l.viewportRegion(),l.inRegion(e.getDOMNode(),i,!1)?s.now[f]=e:s.viewport[f]=e}}),v(p),s},initApplet:function(e,n){!(n=n||{}).node&&n.guid&&(n.node=a.getNode(n.guid));var p,o,s,r,l=n.node;if(!l||!l._node||l.hasClass(g))return null;if(p=a.getGuid(l),o=a.getType(l),e.applets[p]){if(!n.replace)return e.applets[p];try{e.applets[p].destroy()}catch(u){if(y)throw u;c.error(t,{},{code:"appdestroy",message:u.stack||u.message,appletType:o})}delete e.applets[p]}if(l.addClass(g),w(s=o+"_aptNew",!0),r={guid:p,type:o,container:"#"+l.get("id")},y)return e.applets[p]=new i.Applet(r),e.applets[p].addTarget(e),v(s,!0),e.fire(f,{applet:{guid:p,type:o}}),l.removeClass(g),l.removeAttribute(d),e.applets[p];try{return e.applets[p]=new i.Applet(r),e.applets[p].addTarget(e),v(s,!0),e.fire(f,{applet:{guid:p,type:o}}),l.removeAttribute(d),e.applets[p]}catch(h){return c.error(t,{},{code:"appinit",message:h.stack||h.message,appletType:o}),null}finally{l.removeClass(g)}}},e.namespace("Af").AppletInit=A},"@VERSION@",{requires:["af-applet","af-beacon","af-bootstrap","af-config","af-utils","event-touch","oop"]});
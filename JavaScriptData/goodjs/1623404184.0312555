/* repo: newsletter/HEAD@9b2200d-dirty - Package Version: 2.18.0 - 2021-05-05 11:56 am - User:  */
/*! hover-newsletter-counter */
define(["newsletter/1/authmodule"],function(e){var t;return t={authmodule:e,id:void 0,views:3,active:!0,cookieName:"nls2",viewsCap:9,totalPV:0,init:function(t,i){var s=this;if(!t||!t.id||!t.nl)return this.debug("missing settings"),void 0;if(this.debug("settings are as follows"),webmd.debug(t),$.extend(this,t),this.newsletterOndemand===!0)this.display(this.timerOverride);else{if(webmd.url.getParam("ecd")&&webmd.url.getParam("ecd").indexOf("wnl")>-1){var n=e.generate({ishashRequest:!0}),a="",o="";window.webmd&&window.webmd.url&&(window.webmd.url.getSLD()&&(o=window.webmd.url.getSLD()),window.webmd.url.getParam("mb")&&(a=window.webmd.url.getParam("mb")));var r=new $.Deferred;return""!==a&&$.ajax("https://www.webmd.com/api/svcgateway/v2/reg/regservice.asmx/GetHashEmail",{type:"post",headers:n,data:{EncryptedGuid:a},success:function(e){webmd.cookie.set("REG_UUID",e.Email,{expires:36500,domain:o})},error:function(e,t,i){r.reject(e,t,i)}}),this.debug("suppressed the newsletter for pages with ecd-wnl url"),void 0}if(this.cookieGet(),!this.active&&!this.isTestMode())return this.debug("inactive"),void 0;if(i||(s.totalPV!==s.views&&s.increment(),$(document).on("after_pv",function(){s.totalPV!==s.views&&(s.increment(),s.init(t,!0))})),this.isPageExcluded())return this.debug("excluded on this page"),void 0;this.shouldDisplay()?(this.debug("should display"),webmd.p.pim.increment(),this.deactivate(),this.display()):(this.debug("should not display"),this.cookieSet())}},isTestMode:function(){return webmd.url.getParam("testnewsletterhover")},isPageExcluded:function(){var e=!1;return webmd.sitefrontsConfig&&webmd.sitefrontsConfig.nav?"TOC - Channel"===window.s_business_reference&&(this.debug("NL hover on Sitefronts TOC channel is suppressed as per requirement"),e=!0):e=!0,window.enableAutoNL&&(e=!1),e},checkSensitive:function(){var e=!1;return window.s_sensitive&&-1===window.s_business_reference.toLowerCase().indexOf("news")&&(0===window.s_topic.search(/^7\d*/)&&"7019"!==window.s_topic?e=!0:window.secTopId&&""!==window.secTopId&&window.secTopId.split(",").forEach(function(t){e||0!==t.search(/^7\d*/)||"7019"===t||(e=!0)})),e},cookieGet:function(){var e;return webmd.cookie.exists(this.cookieName)?(this.debug("cookie value = "+webmd.cookie.get(this.cookieName)),e=webmd.cookie.getJson(this.cookieName),this.active=Boolean(e.a===void 0),this.totalPV=e.i||0,void 0):(this.debug("cookie was not found."),void 0)},cookieSet:function(){var e,t;e={},this.active?e.i=this.totalPV:(e.a=0,t=7),webmd.cookie.setJson(this.cookieName,e,{domain:webmd.url.getSLD(),expires:t})},increment:function(){var e;e=this.cap(this.totalPV+1),this.totalPV=e,this.cookieSet(),this.debug("target views = "+this.views)},shouldDisplay:function(){return this.isTestMode()||this.totalPV===this.views},getOptions:function(e){var t={reqModule:"newsletter/1/moduleUI-daily",containerId:"newsletterHover",mode:"daily-hover",reqCss:"css!newsletter/1/newsletter-signup-daily.css",width:"650px",responsive:!1,overlayWrapper:"newsletter-hover"},i={reqModule:"newsletter/1/moduleUI-daily-mobile",containerId:"newsletterHover",mode:"daily-mobile",reqCss:"css!newsletter/1/newsletter-signup-daily.css",width:"650px",responsive:!1,overlayWrapper:"newsletter-hover"},s=webmd.useragent.ua.type&&"mobile"===webmd.useragent.ua.type;switch(t.divContainer='<div id="'+t.containerId+'" class="newsletter-daily hover"></div>',i.divContainer='<div id="newsletterHoverContainer"><div id="'+i.containerId+'" class="newsletter-daily"></div></div>',e){case 1162:case 1096:case 1091:return{reqModule:"newsletter/1/moduleUI-pregnancy",containerId:"pregnancyHover",divContainer:'<div id="pregnancyHover" class="nls-preg hover"></div>',mode:"pregnancy",reqCss:"css!newsletter/1/newsletter-pregnancy.css",width:s?void 0:1012,responsive:!0,overlayWrapper:"nls-preg-hover"};default:return s?i:t}},display:function(e){var t=this,i=webmd.useragent.ua.type&&"mobile"===webmd.useragent.ua.type,s=t.getOptions(t.id).containerId,n=t.getOptions(t.id).reqModule,a=t.getOptions(t.id).divContainer,o=t.getOptions(t.id).mode,r=t.getOptions(t.id).reqCss,d=t.getOptions(t.id).responsive,l=t.getOptions(t.id).overlayWrapper,m=null;m=webmd.hoverTest===!0?webmd.hoverNlArray:t.nl[0],e=e!==void 0?e:i?5e3:3e3,t.config=$.extend({},t.config,{nl:m,header:t.header,subhead:t.subhead,selector:"#"+s,uiMode:o,adServed:t.adServed,newsletterOndemand:t.newsletterOndemand}),setTimeout(function(){require([n,r],function(e){var s=new e,n=navigator.userAgent.match(/(iPhone|iPod touch);/i);return $("#decision_select").length>0?(webmd.debug("NLHover module suppressed due to Decision Select"),webmd.cookie.deleteCookie("nls2",{domain:"webmd.com",path:"/"}),webmd.cookie.deleteCookie("ads_sess",{domain:"webmd.com",path:"/"}),webmd.debug("NLHover cookie reset | PIM counter reset"),void 0):(!d&&i?(1>$("#newsletterHoverContainer").length&&$("body").append(a),s.init(t.config),setTimeout(function(){s.show(),wmdPageLink("nl-hov_imp");var e=$(".nls-email");$("#newsletterHoverContainer"),n&&(e.on("mousedown focus",function(){$("body").css({overflow:"hidden",position:"fixed"})}),e.on("blur",function(){setTimeout(function(){$("body").css({overflow:"auto",position:"static"})},1e3)}))},0)):webmd.overlay.open({width:window.nlOverlayWidth?window.nlOverlayWidth:t.getOptions(t.id).width,html:a,scrolling:!1,transition:"none",onComplete:function(){s.init(t.config),wmdPageLink("nl-hov_imp"),$("#webmdHoverWrapper").addClass(l),$("#webmdHoverOverlay").addClass(l),"570px"!==$("#webmdHoverLoadedContent").css("width")&&$("#webmdHoverLoadedContent").css({width:"570px"}),webmd.overlay.resize(),webmd.overlay.autoClosed=!1},onClosed:function(){clearTimeout(window.nlsOverlayTimeout),webmd.overlay.autoClosed||wmdPageLink("nl-hov_x")}}),void 0)})},e)},deactivate:function(){this.active=!1,this.cookieSet()},cap:function(e){return e>this.viewsCap&&(e=this.viewsCap),e},debug:function(e){webmd.debug("Newsletter hover: "+e)}}});
YUI.add("af-applet-mgr",function(e,t){"use strict";var o=e.Af.AppletDom,a=e.Af.Beacon,p=e.Af.Transport,n=e.Af.Utils,i=e.Lang.isFunction;function r(){}function l(){}function c(){}function m(){}r.prototype={name:"applet.add",execute:function(e,t,o){if("applet.add"!==t.action)return o();this.addApplet(e,t.params.type,t.params.config,t.params.settings,t.params.location,t.callback),o()},addApplet:function(t,a,i,r,l,c){c=c||n.noop,a?((l=l||{}).container=l.container||o.getContainerGuid(e.one(o.selectors().container)),l.index=l.index||0,p.create("applet",{type:a},{config:i,settings:r,location:l},function(a,p){if(!a&&n.objectGetValue(p,"content.chrome.html")){var i,r,m=o.getContainerNode(l.container),s=p.content.chrome;i=e.Node.create(s.html),(m=o.getContainerContentNode(m)).insert(i,l.index),s.assets&&e.Af.Dom.jsAttach(s.assets),t.execControllers({action:"applet.init",params:{node:i,replace:!1}}),e.use("stencil",function(e){e.Stencil.initAll(i)}),r=o.getGuid(i),t.fire("appletadd",{applet:{guid:r,type:o.getType(i)}}),c(null,null)}else c(a||"no content")})):c("missing type")}},l.prototype={name:"applet.move",execute:function(e,t,o){"applet.move"===t.action&&this.moveApplet(e,t.params.guid,t.params.from,t.params.to,t.params,t.callback),o()},moveApplet:function(e,t,a,r,l,c){i(l)&&(c=l,l={}),c=c||n.noop;var m,s=!0===(l&&l.moveBeforePersist),f=!1!==(l&&l.save),u=this;if((a=a||o.getLocation(t))&&r){if(m=o.getType(t),!f)return u._updateDom(e,t,a,r),void c();s&&u._updateDom(e,t,a,r),p.update("applet.layout",{guid:t,type:m},{from:a,to:r},function(o){o?c(o):(s||u._updateDom(e,t,a,r),c())})}else c("invalid from/to location")},_updateDom:function(e,p,n,i){var r=e.applets[p];if(o.getContainerNode(i.container))o.move(p,n,i);else if(o.remove(p),r){try{r.destroy({remove:!0})}catch(l){a.error(t+":destroy",{applet:r.get("type")},l)}delete e.applets[p]}e.fire("appletmove",{applet:{guid:p,type:r?r.get("type"):null,from:n,to:i}})}},c.prototype={name:"applet.remote",execute:function(t,o,a){var p=e.Af.Content;"applet.remote"===o.action?p.remoteApplet(t,o.params,o.callback):"page.init"===o.action&&t.after("*:remoteapplet",function(e){var o=e.remoteapplet;p.remoteApplet(t,o,o&&o.callback)}),a()}},m.prototype={name:"applet.remove",execute:function(e,t,o){"applet.remove"===t.action||"removeapplet"===t.action?this.removeApplet(e,t.params.guid,t.params,t.callback):"page.init"===t.action&&e.after("*:removeapplet",function(t){this.removeApplet(e,t.removeapplet.guid||t.applet.guid,t.removeapplet)},this),o()},removeApplet:function(e,r,l,c){if(i(l)&&(c=l,l={}),c=c||n.noop,r){var m=o.getType(r)||null,s=!0===(l&&l.removeBeforePersist);if(!(!1!==(l&&l.save)))return f(),void c();s&&f(),p.update("applet.layout",{guid:r,type:m},{from:o.getLocation(r),to:null},function(e){e?c(e):(s||f(),c())})}else c("missing guid");function f(){o.remove(r,function(){e.fire("appletremove",{applet:{guid:r,type:m}})});var p=e.applets[r];if(p){try{p.destroy({remove:!0})}catch(n){a.error(t+":destroy",{applet:m},n)}delete e.applets[r]}}}},e.namespace("Af").AppletAdd=r,e.Af.AppletMove=l,e.Af.AppletRemote=c,e.Af.AppletRemove=m},"@VERSION@",{requires:["af-applet-dom","af-beacon","af-content","af-transport","af-utils"]});
YUI.add("type_abu_video_manager",function(c,x){var G={article:"1",slideshow:"2",video:"3"};var E=c.Object.getValue(YUI,["Env","My","settings","context"]);var H=(E.videoAutoplay===1);var D="prod";var e=(E.videoBuffering===0);var f=(E.videoRelated===0);var v=(E.videoForcedError===1);var z=(E.videoFullscreen===1);var r=(E.videoHtml5===1);var o=(E.videoLooping===1);var J=E.videoMaxInstances||12;var y=E.videoMaxLoops||3;var h=E.videoSingleVideo||false;var t=(E.videoMinControls===1);var w=E.videoMute===1;var d=E.videoPausescreen;var m=E.videoQosRate||".1";var l=E.videoSSButton;var b=E.videoExpName||"default";var j=E.videoComscoreC4||"TW fp";var q=(E.videoAdBeaconsDisabled===1);var C=E.videoYwaRate||"0";var g=E.suppressAdContext||false;var a=E.videoplayerUrl;c.VideoManager={STATE:{playerJs:"not-ready",isWindowFocused:true,isLightboxOpen:false},VIDEO_MAP:{},FAILED_VIDEO_MAP:{},init:function(){var L=this;c.Af.Event.on("content:init",L.onContentEvent,L);c.Af.Event.on("content:batch",L.onContentEvent,L);c.Af.Event.on("video_state:change",L.onVideoStateChange,L);c.Af.Event.on("video:hide",L.onVideoHide,L);c.Af.Event.on("video:show",L.onVideoShow,L);c.on("blur",L.onWindowBlur.bind(L),window);c.on("focus",L.onWindowFocus.bind(L),window);c.Af.Event.on("lightbox:show",L.onLightboxShow,L);c.Af.Event.on("lightbox:hide",L.onLightboxHide,L);L.activeVideosInit();},onContentEvent:function(Q){var L;var N;var O=this.getContainerNodes(Q.guid,Q.list);var P;var R;var M=this;destroyableVideos=this.findDestroyableVideos();if(destroyableVideos&&destroyableVideos.length>0){this.destroyVideos(destroyableVideos);}if(!O||!O.length){return;}L=function(){M.createVideos(O);};N=function(){M.initPlayerJs(L);};P=O[0];if(P&&typeof P.inViewportRegion==="function"){R=P.inViewportRegion();}if(this.STATE.playerJs!=="ready"){if(R){N();}else{c.one("window").once("scroll",N);}}else{if(R){L();}else{c.one("window").once("scroll",L);}}},onVideoStateChange:function(L){if(!L){return;}if(L.isInViewport()&&L.isDestroyed()){this.createVideo(L.containerNode);}if(L.isPlayable()){if(h&&this.isAnyVideoPlaying()){return;}L.play();}else{if(!L.isLiveEvent()){L.pause();}else{if(L.isMute()){L.pause();}}if(h&&this.STATE.isWindowFocused&&!this.STATE.isLightboxOpen){guid=L.getGuid();videoGuids=this.findPlayableVideos();for(i=0;i<videoGuids.length;i++){if(guid===videoGuids[i]){continue;}playableVideo=this.VIDEO_MAP[videoGuids[i]];if(!playableVideo){continue;}playableVideo.play();break;}}}},onVideoShow:function(L){var M=this.VIDEO_MAP[L];if(!M){return;}M.show();},onVideoHide:function(L){var M=this.VIDEO_MAP[L];if(!M){return;}M.hide();},onWindowBlur:function(){this.STATE.isWindowFocused=false;this.disableAllVideos();},onWindowFocus:function(){this.STATE.isWindowFocused=true;this.enableAllVideos();},onLightboxShow:function(){this.STATE.isLightboxOpen=true;this.disableAllVideos();},onLightboxHide:function(){this.STATE.isLightboxOpen=false;this.enableAllVideos();},disableAllVideos:function(){var L=Object.keys(this.VIDEO_MAP);if(!L.length){return;}this.disableVideos(L);},enableAllVideos:function(){if(this.STATE.isLightboxOpen||!this.STATE.isWindowFocused){return;}var L=Object.keys(this.VIDEO_MAP);if(!L.length){return;}this.enableVideos(L);},initPlayerJs:function(N){var L=this;var M=function(){L.STATE.playerJs="ready";if(typeof N==="function"){N.call(L);}};if(this.STATE.playerJs==="not-ready"){if(this.isPlayerJsLoaded()){M();return;}this.STATE.playerJs="fetching";if(a&&!c.config.groups.videoplayer){yuiConfig={modules:{videoplayer:{group:"videoplayer",name:"videoplayer",type:"js",fullpath:a}},groups:{videoplayer:{name:"videoplayer",combine:false,filter:"min"}}};c.applyConfig(yuiConfig);}}c.use("videoplayer",M);},activeVideosInit:function(){var L=this;if(!window.VEX){return;}L.initPlayerJs(c.bind(L.videoModeInstancesInit,L));},videoModeInstancesInit:function(){var M=this;var R;var L;var Q;var N;var O;var P;if(!window.VEX){return;}c.Array.each(window.VEX.VideoModeInstances,function(S){R=S&&S.getPlayerInfos&&S.getPlayerInfos();if(R){L=R.config||{};P=L.autoplay;Q=c.one(R.node);N=Q.generateID();O=new c.Video(Q,{isAutoplayable:P,isDestroyable:false,isMute:L.mute,isPlaying:P,isLiveEvent:true});O.videoPlayer=R.instance;O.videoNode=Q;O.guid=N;O.attachListeners();M.VIDEO_MAP[N]=O;}});},isPlayerJsLoaded:function(){return YAHOO&&YAHOO.VideoPlatform&&YAHOO.VideoPlatform.VideoPlayer;},getContainerNodes:function(P,M){var O=c.one("#applet_"+P);var N=[];var L=this;if(!O){return null;}c.Array.each(M,function(Y){var W;var Q=null;var S;var X;var V;var T;var R;if(Y&&Y.type===G.video){Q=O.one('[data-uuid="'+Y.id+'"]');if(Q){if(Y.videoAdAssets){S=L.mapVideoAdAssets(Y.videoAdAssets);V=S.videoUrl;}W=Y.videoAdImage;X=Y.videoAdBeacons;if(V){Q.setData("videoUrl",V);if(q&&V){R=Array.isArray(Y.videoAdAssets)?c.Object.getValue(Y,["videoAdAssets",0,"mediaInfo"]):Y.videoAdAssets.mediaInfo;T={clickUrl:Y.link,mediaInfo:R};c.Array.each(T.mediaInfo,function U(Z){Z.height=parseInt(Z.height,10);Z.width=parseInt(Z.width,10);Z.bitrate=parseInt(Z.bitrate,10);Z.length=parseInt(Z.length,10);});if(X){c.Object.each(X,function(aa,Z){if(Array.isArray(aa)){X[Z]=aa;}else{X[Z]=[aa];}});}Q.setData("geminiData",T);}}if(W){Q.setData("imageUrl",W);}if(X){Q.setData("videoBeacons",X);}if(Y.videoAdRules){c.Object.each(Y.videoAdRules,function(aa,Z){if(Array.isArray(aa)){c.Object.each(aa,function(ab){c.Object.each(ab,function(ad,ac){ab[ac]=parseInt(ad,10);});});}else{c.Object.each(aa,function(ac,ab){aa[ab]=parseInt(ac,10);});}});Q.setData("videoRules",Y.videoAdRules);}N.push(Q);}}});if(N&&N.length>0){return N;}return null;},mapVideoAdAssets:function(L){var P={VIDEO_PRIMARY:{contentType:"video/mp4",assetName:"videoUrl"}};var Q;var O={};var R;var N;var M=function(U,S){var T=new RegExp(U);return T.test(S.contentType);};L=L?[].concat(L):[];L.forEach(function(S){var T=P[S.usageType];S.mediaInfo=S.mediaInfo?[].concat(S.mediaInfo):[];if(T){if(S.mediaInfo.length>1){N=S.mediaInfo.filter(M.bind(null,T.contentType))||[];}else{N=S.mediaInfo;}O[T.assetName]=N[0]&&N[0].url;}});return O;},createVideos:function(M){var L;if(!M||!M.length){return;}for(L=0;L<M.length;L++){this.createVideo(M[L]);}},createVideo:function(aa){var U;var ac;var L;var M;var S;var Y=true;var P;var N;var W;var Q;var V;var Z;var ab;var R;var X;var T;var O;if(!aa||!aa.getDOMNode()){return;}T=aa.getData("videoManagerConfig")||{};X=aa.getData("videoConfig")||{};S=aa.getData("opts")||{};P={isAutoplayable:(typeof X.autoplay!=="undefined")?X.autoplay:H,isDestroyable:(typeof S.isDestroyable!=="undefined")?S.isDestroyable:true};aa.detachAll();R=aa.getData("videoBeacons");O=aa.getData("videoUrl");ac=aa.getData("imageUrl");ab=new c.Video(aa,P);L=ab.isPlayable();if(h){Y=!this.isAnyVideoPlaying()&&Y;}Y=P.isAutoplayable&&L&&Y;X.autoplay=Y;if(O){M=this.createMediaItemsByUrls([{videoUrl:O||"",imageUrl:ac||""}]);if(q){M=[{id:"6bf451fd-11f9-37f9-a54c-d73d795839f6",images:{thumbnail:ac}}];X.YVAP={standaloneAd:{gemini:aa.getData("geminiData"),rules:aa.getData("videoRules"),beacons:R}};}}else{Z=ab.getUuid();if(!Z){return;}M=this.createMediaItemsByUuids([Z]);}X=this.createVideoConfig(X,M);if(O){X.disableRecoverer=true;X.expName="gemini-hpstrm";}ab&&ab.createVideoPlayerByConfig(X);Q=(typeof T.uiControl!=="undefined")?X.uiControl:t;W=!!ab.containerNode.one(".js-cstm-end-screen")||Q;if(W){V=new k(ab,{shouldShowOverlayButtons:Q});V.setUp();}c.Global.fire("video-manager:create_player_instance",ab);if(S.createVideoOnly){return;}U=aa&&aa.generateID();if(U){this.VIDEO_MAP[U]=ab;}},createMediaItemsByUuids:function(O){var N;var L;var M=[];if(!O||!O.length){return;}for(N=0;N<O.length;N++){L={id:O[N]};M.push(L);}return M;},createMediaItemsByUrls:function(P){var O;var L;var N=[];var M;if(!P||!P.length){return;}for(O=0;O<P.length;O++){M=P[O];L={streams:[{url:M.videoUrl}],images:{thumbnail:M.imageUrl}};N.push(L);}return N;},createVideoConfig:function(N,M){var O;var L;O={autoplay:H,comscoreC4:j,continuousPlay:false,disableCasting:true,expBucket:c.Af.Config.getContext("bucket"),expName:b,expType:"strm-inline",fullscreenBtn:z,html5:r,lang:c.Af.Config.getContext("lang")||"en-US",loop:o,mute:w,pageSpaceId:c.Af.Config.get("spaceid"),pausescreen:d,playlist:{mediaItems:M},preload:true,qosSamplingRate:parseFloat(m),region:c.Af.Config.getContext("region")||"US",replayonlyendscreen:f,stopBufferingOnPause:e,settingscreen:false,site:"frontpage",startscreen:{showButton:l,showDesc:false,showProvider:false,showTitle:false},CMS:{env:D,suppressAdContext:g},videoapps:false,ywaSamplingRate:parseFloat(C)};if(N&&typeof N==="object"){L=c.merge(O,N);}return L;},isAnyVideoPlaying:function(){var O=Object.keys(this.VIDEO_MAP);var L;var N=false;var M;for(L=0;L<O.length;L++){guid=O[L];M=this.VIDEO_MAP[guid];N=M&&M.isPlaying();if(N){return N;}}return N;},findPlayableVideos:function(){var P=Object.keys(this.VIDEO_MAP);var L;var M;var O=[];var N;for(M=0;M<P.length;M++){L=P[M];N=this.VIDEO_MAP[L];if(N&&N.isPlayable()){O.push(L);}}return O;},findDestroyableVideos:function(){var P=[];var O=Object.keys(this.VIDEO_MAP);var L;var M;var N;for(M=0;M<O.length;M++){L=O[M];N=this.VIDEO_MAP[L];if(!N){P.push(L);continue;}if((N.isDestroyable()&&P.length===0)||N.isDOMNodeRemoved()){P.push(L);}}return P;},disableVideos:function(L){var M;var N;var O;for(N=0;N<L.length;N++){M=L[N];O=this.VIDEO_MAP[M];O&&O.disable();}},enableVideos:function(L){var M;var N;var O;for(N=0;N<L.length;N++){M=L[N];O=this.VIDEO_MAP[M];O&&O.enable();}},destroyVideos:function(L){var M;var N;var O;for(N=0;N<L.length;N++){M=L[N];O=this.VIDEO_MAP[M];O&&O.destroy();O=null;delete this.VIDEO_MAP[M];}}};c.VideoManager.init();var F="ui-wrapper";var n="ui-mute-btn";var A="ui-expand-btn";var I="ui-state-is-mute";var p="ui-state-is-expanded";var K="ui-overlay-btns";var u="D-n";var s={isMute:I,isExpanded:p};var B={shouldShowOverlayButtons:false};var k=function k(M,L){this.video=M;this.wrapperNode=null;this.containerNode=this.video&&this.video.containerNode;this.options=L||B;};k.prototype.setUp=function(){if(this.options.shouldShowOverlayButtons){this._createOverlayButtons();}if(!this.containerNode||!this.containerNode.getDOMNode()){return;}this.containerNode.on("video_state:change",this._onVideoStateChange,this);};k.prototype._createOverlayButtons=function(){var O;var L;var N;var M;if(!this.video){return;}M=this.video.videoNode;if(!M||!M.getDOMNode()){return;}N=M.one(".yvp-custom-controls");if(!N){return;}this.wrapperNode=c.Node.create('<div class="'+F+'"></div>');O=c.Node.create('<span class="'+n+'"><i></i></span>');L=c.Node.create('<span class="'+A+'"><i></i></span>');N.addClass(K);N.append(this.wrapperNode);this.wrapperNode.append(O);this.wrapperNode.append(L);this.wrapperNode.delegate("click",this._onMuteBtnClick,"."+n,this);this.wrapperNode.delegate("click",this._onExpandBtnClick,"."+A,this);this._onVideoStateChange("isMute",this.video.isMute());};k.prototype._onMuteBtnClick=function(){if(!this.video){return;}this.video.setMute(!this.video.isMute());};k.prototype._onExpandBtnClick=function(){if(!this.video||!this.containerNode){return;}this.containerNode.fire("video_expand",!this.video.isExpanded());};k.prototype._onVideoStateChange=function(M,O){if(!this.containerNode||!this.containerNode.getDOMNode()){return;}var N=s[M];if(N){if(O){if(!this.containerNode.hasClass(N)){this.containerNode.addClass(N);}}else{this.containerNode.removeClass(N);}}var L;var P;if(M==="isOnEndScreen"){L=this.containerNode.one(".js-cstm-end-screen");if(L){if(O===false){L.hide();}else{P=this.containerNode.one(".yvp-bottom-bar");if(P){L.remove();this.containerNode.insert(L,P);if(L.hasClass(u)){L.removeClass(u);}L.show();}}}}};},"0.0.1",{requires:["af-content","af-event","base","event-custom","type_abu_event","type_abu_video","node-core"]});/* Copyright (c) 2021, Yahoo! Inc.  All rights reserved. */
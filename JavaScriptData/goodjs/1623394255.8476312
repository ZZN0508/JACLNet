YUI.add("af-applet",function(e,t){"use strict";var i=e.Af,n=i.Utils,r=e.Lang,a=e.Object,s=e.Array,o=i.Config,l=i.Bootstrap,g="container",p="guid",c="model",f="type",d="footer",v="header",u="edit",w="main",h=o.isDev(),V=r.isFunction,_=n.objectGetValue,m=n.objectMerge,y=n.perfStart,A=n.perfStop;function M(e){if(!e)return e;var t=e.split("-");return(t=s.map(t,function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(".")}function C(t){e.EventTarget.prototype.constructor.call(this),this.initializer(t)}e.extend(C,i.CompositeView,{views:{main:{region:w},settings:{region:u},remove:{region:u},moreinfo:{region:u},header:{region:v},footer:{region:d}},regions:{main:{view:w},header:{view:v},footer:{view:d},edit:{defer:!0,view:"settings"}},allowRegionLateBind:!1,initializer:function(n){var s=this;s.guid=n.guid,s.type=n.type,s.clientId=e.guid("appletClientId_"),s.container=e.one(n.container),s._destroyed=!1,s.views=m(s.views,n.views),s.regions=m(s.regions,n.regions),a.each(s.regions,function(e,t){var i=s.getRegion(t);i||(i=s.createRegion(t,e.selector))}),s._bootstrapMV(function(e){try{if(e)return;var o=n.type+":aptShowViews";y(o),a.each(s.regions,function(e,t){if(e&&e.view){var i,n=s.getRegion(t);n&&(i=r.isString(e.view)?s.getView(e.view):e.view)&&n.showView(i)}}),A(o)}catch(l){if(h)throw l;i.Beacon.error(t,{},{code:"appbstrap",message:l.stack||l.message,appletType:s.type})}}),s._eventHandlers=[],s._eventHandlers.push(s.after("*:showmessage",function(e){i.Message.show(s.get(g),e.showmessage)}))},destroy:function(){var e=this,t=e.get(c);e.destroyViews(),e._regions=e._views=e.views=e.regions=null,t&&(e.set(c,null,{silent:!0}),t.destroy()),s.each(e._eventHandlers,function(e){e&&e.detach()}),e._eventHandlers=null,e._destroyed=!0,e.fireEvent("appletdestroyed"),e.detachAll()},createView:function(t){var n,r,a,s=this,o=s.views[t],d=i.AppletDom.classes().view_container_prefix+t;return o&&o.region&&!s.getRegion(o.region)?null:(r=s._getViewClass(t))?((n=e.merge({applet:s,name:t,guid:s.get(p),type:s.get(f),model:s.get(c),container:s.get(g).one("div."+d)},l.getViewMeta(s.get(p),t).config)).container||(n.container=e.Node.create('<div class="'+d+'"/>')),(a=new r(n)).addTarget(s),s.setView(t,a),a):null},fireEvent:function(e){this.fire(e,{applet:{guid:this.get(p),type:this.get(f),clientId:this.clientId}})},getViews:function(){return this._views},get:function(e){return this[e]},set:function(e,t){this[e]=t},regionForView:function(e){var t=this.views&&this.views[e];return t?t.region:null},_bootstrapMV:function(e){var t=this,i=t.get(g),n={batch:r.isValue(i.getData("applet-defer"))};i.one(".App-Toolbar_v2")&&(n.extraMods=["af-applet-editview","af-applet-settingsview"]),l.load(t.get(p),n,function(i){if(i)e(i);else if(t._destroyed)e("applet was destroyed");else{var n=t.get(f),r=n+":aptCreateModel";y(r),t._createModel(),A(r),y(r=n+":aptCreateViews"),t._createViews(),A(r),e()}})},_createModel:function(){var e=this._getModelClass();this.set(c,new e({guid:this.get(p),type:this.get(f)}))},_createViews:function(){var t=this,n=t.get(g),r=l.getMeta(t.get(p)).views,o=i.AppletDom.classes().view_container_prefix;a.each(r,function(i,n){var r;(i=e.merge(t.views[n],i)).isActiveView&&i.region&&(r=t.regions[i.region])&&(r.view=n)}),a.each(t.regions,function(e,i){var r,a,l,g;if(r=i,a=e.view,l=["js-applet-view-container"],(g=n.one("div[data-region="+r+"]"))&&(r!==a&&l.push(o+r),s.forEach(l,function(e){var t=g.one("div."+e);t&&t.replaceClass(e,o+a)})),!e.defer){var p=e.view&&t.createView(e.view);p&&p.render()}})},_getModelClass:function(){var t=l.getModelClass(this.get(p),"applet_model");return V(t)?t:(t=_(e,M(this.get(f))+"AppletModel"),V(t)?t:i.AppletModel)},_getViewClass:function(t){var n,r=this.get(p),s=l.getViewClass(r,t);if(V(s))return s;if(s=_(e,M(this.get(f))+M(t)+"View"),V(s))return s;if(n=l.getViewMeta(r,t),0===a.size(n)){if(t===d)return null;if(t===v)return null}return s=_(e.Af,"Applet"+M(t)+"View"),V(s)?s:this.views[t]&&this.views[t].region===u?e.Af.AppletEditView:i.AppletView}}),e.EventTarget&&e.augment(C,e.EventTarget,!0,null,{emitFacade:!0,prefix:"AfApplet"}),e.namespace("Af").Applet=C},"@VERSION@",{requires:["af-applet-dom","af-applet-model","af-applet-headerview","af-bootstrap","af-compositeview","af-config","af-utils","array-extras","event-custom","node","stencil-tooltip"]});
var _i_=this._i_||function(){},_r_=this._r_||function(e){return e};B.define("hotel/tpi/data-api",function(e,i,r){_i_("50d:8abfc0fa");var _,t,n=e("promise");function d(e){_i_("50d:a0cb4c70"),B.squeak&&B.env.wholesaler_configuration.tpi_track_ajax_failures&&e&&B.squeak(e),_r_()}function h(e,i){return _i_("50d:c6ffc0a4"),_r_(function(){return _i_("50d:084bf321"),_r_(e.apply(i,arguments))})}r.exports={run:function(s,c,l,e){_i_("50d:56ae6702");var f=(B.env||{}).wholesaler_configuration||{};return t&&e&&(t.should_abort=1,_=void 0),_||(_=new n(h(function(i,r){if(_i_("50d:78db3079"),c&&l||r("Error: Missing args, avData, avData, frgName and frgData  are required"),B.env.wholesaler_configuration.worker_url&&B.env.wholesaler_configuration.decision_url&&B.env.b_fragment_url_json){var e=B.env.b_fragment_url_json.split("?"),_=1<e.length?e[1]:"",t=Object.assign({},c),n=Object.assign({},l);n.exps=B.env.wholesaler_configuration.tpi_exps||{},t.url=s,B.env.wholesaler_configuration.use_k8s_dev_installations&&B.env.wholesaler_configuration.av_url&&(t.use_dev=1,t.av_service_url=B.env.wholesaler_configuration.av_url),t.call_supply_service=B.env.wholesaler_configuration.call_supply_service,t.worker_token=B.env.wholesaler_configuration.worker_token,t.frag_url=B.env.wholesaler_configuration.decision_url+"?"+_,t.frag_req=n,(a=B.env.wholesaler_configuration.worker_url,o=t,_i_("50d:0bc02a2f"),_r_($.ajax({type:"POST",url:a,data:JSON.stringify(o),cache:!1,xhrFields:{withCredentials:!0},dataType:"json",contentType:"application/json; charset=utf-8",timeout:2e4}))).then(h(function(e){_i_("50d:700af058"),this.should_abort?r("frg-aborted"):e&&e.data?i(e.data):r("frg-error"),_r_()},this),function(e,i){_i_("50d:bde19a10"),d(i&&"timeout"===i?f.tpi_av_timeout_squeak_name:f.tpi_av_squeak_name),r("av-error"),_r_()})}else d("tpi-client-fallback-"+B.env.b_site_type+"-"+B.env.b_action);var a,o;_r_()},t={}))),_r_(_)}},_r_()}),B.define("hotel/tpi/postproc-api",function(e,i,r){_i_("50d:cca324dc"),r.exports={send_postproc_request:function(e){_i_("50d:97faa462");var i="";"object"==typeof e?(e.forEach(function(e){_i_("50d:1bdb3ed6"),i+=e+"_",_r_()}),i=i.substring(0,i.length-1)):i=""+e;var r=B.env.b_countrycode;$.getJSON("/tpi_postproc?hotel_ids="+i+"&cc="+r+"&src=sr",null,function(){}),_r_()}},_r_()}),B.define("searchresults/tpi/data-api",function(e,i,r){_i_("50d:623da6bd");var _=new(B.require("event-emitter"));r.exports={emitTpiDataEvent:function(e){_i_("50d:936f124e"),_.emit("tpi_data",e),_r_()},onTpiData:function(e){_i_("50d:96a6acd1"),_.on("tpi_data",e),_r_()}},_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration}).run(function(t){_i_("50d:f3038414");var n=t("et"),a="PPXGDPTPVSPXBFAHNEYRAKe";if(B.env.fe_is_tdot&&!n.track(a))return _r_();var o=t("searchresults/tpi/data-api"),s=t("hotel/tpi/data-api"),c="www"===B.env.b_site_type,e="mdot"===B.env.b_site_type;function r(){_i_("50d:812b1fea");var e,i=(e="wholesaler_configuration",_i_("50d:26e9d9d1"),_r_(c?t("searchresults/env").get(e):B.env[e]));if(i&&i.availability_api_request&&i.decision_fragment_request){var r=Object.assign({},i.availability_api_request);r.use_cache=i.use_cache;var _=Object.assign({},i.decision_fragment_request);s.run(i.b_wholesaler_url,r,_,!0).then(function(e){_i_("50d:9ecda92e"),null!=e&&(B.env.fe_is_tdot&&n.stage(a,1),o.emitTpiDataEvent(function(e){_i_("50d:f3dc79b2");var i={data:{},status:200,status_response:"OK"};for(var r in e){if("exps"===r)continue;i.data[r]=[];var _=e[r],t={};t.wholesaler_code=_.min_room_block.wholesaler_code?_.min_room_block.wholesaler_code:"ag",t.price_formatted=_.min_room_block.price_formatted,t.price_inclusion=_.min_room_block.price_inclusion,t.price_user_currency=_.min_price,t.room_name=_.min_room_block.room_name,t.room_info=_.min_room_block.room_description,t.cancellation_information=_.min_room_block.cancellation_information,t.reservation_meta_data={ratechannel:"Retail"},t.price_detail=_.min_room_block.price_detail,i.data[r].push(t)}e.exps&&(i.exps=e.exps);return _r_(i)}(e))),_r_()}).catch(function(){})}_r_()}if(c){var i=t("searchresults/events");i.on(i.DATA_ENVIRONMENT_UPDATED,r)}if(e){var _=t("event-bus");_.on(_.EVENTS.SR_AJAX_LOADED,function(e,i){_i_("50d:32526b0f"),0<=i.blocks.indexOf("results")&&r(),_r_()})}r(),_r_()}),B.define("searchresults/tpi/user-utils",function(e,i,r){_i_("50d:4aee45db");var _=B.require("et"),t={TRACKING_ASPECTS:{ALWAYS:"always",IS_GENIUS:"genius",IS_LOGGED_IN:"loggedin",IS_ASIAN:"asian",IS_EARLY:"early",IS_LAST_MINUTE:"lastminute",IS_DOMESTIC:"domestic",IS_INTERNATIONAL:"international",IS_META:"meta"},trackUser:function(e,i){var r;_i_("50d:98c03e0d"),void 0!==(r=i?i[t.TRACKING_ASPECTS.ALWAYS]:1)&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_GENIUS]:2)&&B.env.b_reg_user_is_genius&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_LOGGED_IN]:3)&&0<B.env.auth_level&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_ASIAN]:4)&&t.isUserAsian()&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_EARLY]:5)&&t.isEarlyBooker()&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_DOMESTIC]:6)&&B.env.b_countrycode===B.env.b_guest_country&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_INTERNATIONAL]:7)&&B.env.b_countrycode!==B.env.b_guest_country&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_LAST_MINUTE]:8)&&t.isLastMinuteBooker()&&_.stage(e,r),void 0!==(r=i?i[t.TRACKING_ASPECTS.IS_META]:9)&&"meta"==B.env.b_partner_vertical&&_.stage(e,r),_r_()},isUserAsian:function(){_i_("50d:ee3537b5");var e=!1,i=["cn","kp","kh","mm","la","ph","bn","bt","np","hk","th","mo","sg","jp","lk","id","mv","mn","bd","in","vn","kr","tw","my"];if(B.env.b_guest_country)for(var r=0;r<i.length;r++)i[r]==B.env.b_guest_country&&(e=!0);return _r_(e)},isLastMinuteBooker:function(){if(_i_("50d:31024b7d"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),i=new Date,r=Math.abs(e.getTime()-i.getTime());if(Math.ceil(r/864e5)<=3)return _r_(!0)}return _r_(!1)},isEarlyBooker:function(){if(_i_("50d:ee7d2bef"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),i=new Date,r=Math.abs(e.getTime()-i.getTime());if(30<=Math.ceil(r/864e5))return _r_(!0)}return _r_(!1)}};r.exports=t,_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration&&B.env.wholesaler_configuration.availability_api_request}).run(function(r){_i_("50d:2f3ed11b");var e=r("searchresults/tpi/data-api"),c=r("hotel/tpi/postproc-api"),_=r("searchresults/filters").getInstance,f=r("jquery"),u=r("et"),p="PPXGSCZFRURURNWBOabFIRZZERT",b=B.env.tpi_search_config.b_children_total&&2==u.track(p),m="PPXGSCZFRURURNHPZAWe",v=1<B.env.tpi_search_config.b_nr_rooms_needed&&2==u.track(m),g="PPXGFRURURYTaIXLCTEbaO";function i(){var e;_i_("50d:5ff8f9e4"),this.occupancy=B.env.wholesaler_configuration.availability_api_request.search_config.number_of_adults;var i=r("searchresults/env");if(this.wholesaler_configuration=i.get("wholesaler_configuration"),this.hotel_candidate_list=[],this.hotels_with_no_rate=[],this.search_filters={},this.hotel_info_prices=this.wholesaler_configuration.hotel_info_prices,this.searchresults_ordered_by_price=this.wholesaler_configuration.searchresults_ordered_by_price,this.translations=this.wholesaler_configuration.b_wholesaler_translations,this.rtl=i.get("rtl"),this.search_filters_raw=_(),!this.search_filters_raw.filters["fc-5"]&&!this.search_filters_raw.filters["fc-6"])for(this.hotel_candidate_list=this.wholesaler_configuration.b_wholesaler_hotel_ids,this.wholesaler_configuration.hotels_with_no_rate&&(this.hotels_with_no_rate=this.wholesaler_configuration.hotels_with_no_rate),this.search_filters_raw.filters["fc-2"]&&(this.search_filters.fc=1),this.search_filters.mealplan=0,this.search_filters_raw.filters["mealplan-1"]?this.search_filters.mealplan+=4:this.search_filters_raw.filters["mealplan-3"]?this.search_filters.mealplan=7:this.search_filters_raw.filters["mealplan-8"]?this.search_filters.mealplan=6:this.search_filters_raw.filters["mealplan-9"]?this.search_filters.mealplan=5:this.search_filters_raw.filters["mealplan-4"]&&(this.search_filters.all_inclusive=1),this.search_filters.price_slider_options=B.env.b_slider_options,e=1;e<=4;e++)if(this.search_filters_raw.filters["pri-"+e]){this.search_filters.price_range=e;break}_r_()}function l(e,r){_i_("50d:1f639a01"),e.find("a[href]").each(function(){_i_("50d:a79d53c4");var e=f(this).attr("href"),i=e.indexOf("#");-1===i?e+="&tpi_r="+r:e=e.slice(0,i)+"&tpi_r="+r+e.slice(i),f(this).attr("href",e),_r_()}),_r_()}i.prototype.render=function(e){_i_("50d:ac730b56"),this.search_filters_raw.filters["fc-5"]||this.search_filters_raw.filters["fc-6"]||this.processResult(e),_r_()},i.prototype.checkSearchFilters=function(e){var i;_i_("50d:c0ba7944");for(var r=0;r<e.length;r++){var _=e[r],t=!1;if(f.isEmptyObject(this.search_filters))t=!0;else{var n=!0;if((n=n&&1!=this.search_filters.all_inclusive)&&0<this.search_filters.mealplan)if(_.room_info&&_.room_info.meal_info){var a=0;1===_.room_info.meal_info.has_breakfast&&(a+=4),1===_.room_info.meal_info.has_lunch&&(a+=2),1===_.room_info.meal_info.has_dinner&&(a+=1),n=n&&a===this.search_filters.mealplan}else n=!1;if((n=(n=n&&(!this.search_filters.price_range||1==this.search_filters.price_range))&&(1!=this.search_filters.fc||_.cancellation_information&&_.cancellation_information.refund_info&&0<_.cancellation_information.refund_info.length&&"fully_refundable"===_.cancellation_information.refund_info[0].type))&&(t=!0),this.search_filters.price_slider_options&&this.search_filters.price_slider_options.selected){var o=this.search_filters.price_slider_options.min_selected,s=this.search_filters.price_slider_options.max_selected,c=_.price_user_currency;(s<c||c<o)&&(t=!1)}}if(t){i=_;break}}return _r_(i)},i.prototype.processResult=function(e){if(_i_("50d:3d43b29c"),e&&e.data&&200==e.status){for(var i={},r=0,_=[],t=0;t<this.hotel_candidate_list.length;t++){var n=this.hotel_candidate_list[t],a=e.data[n];if(a&&-1==this.hotels_with_no_rate.indexOf(n)){var o=this.checkSearchFilters(a);if(o){r++,_.push(""+n);var s=f("div.sr_item[data-hotelid='"+n+"']").addClass("hasTPIRateAvailable");s.length&&(this.injectTPIIntoRoomBlock(s,o,e.exps||{}),i[n]={hotel_block:s,room_info:o},l(s,1))}}}0<r&&(_i_("50d:34dd03a1"),f("div.sr_item:not(.hasTPIRateAvailable)").each(function(){_i_("50d:5de3eb7b"),l(f(this),2),_r_()}),_r_(),c.send_postproc_request(_)),this.sortTpiRooms(i)}_r_()},i.prototype.sortTpiRooms=function(e){if(_i_("50d:333a9240"),1===this.searchresults_ordered_by_price&&this.wholesaler_configuration.b_fix_price_sorting){var o,s,c=this.hotel_info_prices;for(o in e){var i=(s=e[o]).room_info.price_user_currency;s.price=i}for(o in e){if(0!=(s=e[o]).hotel_block.find("div.distfromdest--highlight").length)continue;var l=f("div.sr_item.sr_property_block");l.each(function(e){_i_("50d:91092359");var i=f(this),r=i.data("hotelid"),_=Number(c[r]);if(_&&e!==l.length-1)for(var t=e+1;t<l.length;t++){var n=f(l.eq(t)).data("hotelid"),a=Number(c[n]);if(a&&a<_){if(r==o)return _r_(!1);return _r_(!0)}if(0!=a)break}if(_&&_>=s.price)return s.hotel_block.detach(),i.before(s.hotel_block),c[r]=""+s.price,_r_(!1);if(e===l.length-1)return s.hotel_block.detach(),i.after(s.hotel_block),c[r]=""+s.price,_r_(!1);_r_()})}}_r_()},i.prototype.injectTPIIntoRoomBlock=function(e,i,r){if(_i_("50d:ccc4806c"),B.env.tpi_search_config.b_children_total&&u.track(p)&&(u.stage(p,1),u.track(p)<2))return _r_();if(1<B.env.tpi_search_config.b_nr_rooms_needed&&u.track(m)&&(u.stage(m,1),u.track(m)<2))return _r_();var _;u.stage("PPXGFRURURYTbUdSUHTRLFZPeZYaAFZKVHXT",2),i.room_name&&(_=i.room_name),_||(_=i.room_info&&this.translations[i.room_info.booking_room_type]?this.translations[i.room_info.booking_room_type]:this.translations[20]);var t=0;this.rtl&&(t=1);var n=e.find(".room_details"),a=n.find(".sr_room_table"),o=n.find(".sr-cta-button-row");(b||v)&&(a=n.find(".sr_gr.sr-group_recommendation"));var s=i.price_detail&&i.price_detail.total_pay_now_and_pay_at_property_price_pretty?i.price_detail.total_pay_now_and_pay_at_property_price_pretty:i.price_formatted;if(1===a.length){var c=function(e,i){_i_("50d:2da03b31");var r,_={};_.header=e.find("thead").clone(),_.url=e.find(".roomrow").attr("data-link"),_.noScrollUrl=i.find("a").attr("href"),_.bookButtonText=i.find(".js-sr-cta-text").html(),b?(r=B.env.tpi_search_config,_.occupancy=B.jstmpl("b_tpi_occupancy_icons").render({fe_icons_limit:5,fe_num_adults:r.b_adults_total,fe_num_children:r.b_children_total,fe_show_plus_sign_on_children:1,fe_icons_size:10,fe_disable_tooltip:1})):v?(r=B.env.tpi_search_config,_.occupancy=B.jstmpl("b_tpi_occupancy_icons").render({fe_icons_limit:5,fe_num_adults:Math.ceil(r.b_adults_total/r.b_nr_rooms_needed),fe_icons_size:10,fe_disable_tooltip:1})):_.occupancy=e.find(".room_link").find("div").clone();return _.price=e.find(".smart_price_style").clone(),_.roomReinforcment=e.find(".sr_room_reinforcement").clone(),_.bookButton=i.clone(),_r_(_)}(a,o),l={b_tpi_room_name:_,b_tpi_price:s,b_tpi_url:c.noScrollUrl,b_has_breakfast:i.room_info.meal_info.has_breakfast,b_is_rtl:t,prc_stay_night_num:B.env.tpi_los,prc_search_config:B.env.tpi_search_config,exps:r};if(l.b_tpi_book_button_text=c.bookButtonText,2<this.occupancy&&!b&&!v&&(l.fe_occupancy=this.occupancy,n.contents().hide()),u.track(g),i.cancellation_information&&i.cancellation_information.refund_info){var f=i.cancellation_information.refund_info;l.b_free_cancel=0<f.length&&"fully_refundable"===f[0].type,"hu"===B.env.b_guest_country&&l.b_free_cancel&&f[0].penalty_end_date&&(l.b_free_cancel_until=f[0].penalty_end_date)}else l.b_free_cancel=!1;var d=B.jstmpl("b_tpi_room_block_room_integration").render(l);n.append(d),u.initAttributesTracking(n);var h=n.find(".sr_room_table[data-table-type=tpi]");null!=h&&null!=c&&((b||v)&&(o.hide(),n.find(".sr-group-recommendation__title").hide()),function(e,i,r,_){_i_("50d:b5d3242d"),i.find(".tpi_room_name").append(e.occupancy);var t=i.find(".normal_book_button_holder");e.price.html('<label class="bui-radio__label normal_price_label" for="tpi_wholesale_price_radio">'+e.price.html()+"</label>"),e.header.addClass("tpi_room_table_header"),i.hide(),i.prepend(e.header),t.append(e.bookButton),r.hide(),i.show(),i.find(".normal_price_label").addClass("tpi_radio_active"),_r_()}(c,h,a),function(e,i,r){_i_("50d:e4b2b53f");var _=r.find(".bfast-included-ribbon"),t=r.find(".no_cc_02"),n=r.find(".b-no-cc-reinforcement__spacing"),a=r.find("[data-trips-promotion]"),o=i.find(".tpi_room_name_holder");e.room_info.meal_info.has_breakfast||_.hide();t.hide(),n.hide(),r.find(".js_sr_persuation_msg").hide(),r.find(".c-unit-configuration").hide(),a.hide();var s=r.find(".ge-free-room-upgrade-ribbon"),c=r.find(".ge-free-room-upgrade-sr-text");(0<s.length||0<c.length)&&(s.hide(),c.hide());i.find(".tpi_book_button_holder").show(),o.show(),_r_()}(i,h,e),function(i,e){_i_("50d:404fbedd");var r=e.find(".tpi_button_room_integration");e.click(function(){}),r.click(function(e){_i_("50d:dd676a0a"),e.preventDefault(),window.open(i.noScrollUrl,"_blank"),_r_()}),e.find(".roomrow.entire_row_clickable").click(function(){_i_("50d:033af5e5"),u.customGoal(g,1),_r_()}),_r_()}(c,h)),function(e,i){_i_("50d:bcf593e5");var r,_=e.price_detail&&e.price_detail.total_pay_now_and_pay_at_property_price_pretty,t=i.find(".roomPrice");r="inclusive"===e.price_inclusion||_?B.jstmpl.translations("sr_search_card_includes_taxes_charges"):B.jstmpl.translations("sr_hp_taxes_and_charges_exception");t.find(".tpi-price-inclusion__no-radio__caption").text(r),_r_()}(i,n),n.find(".roomrow").attr("data-link",c.url)}_r_()},e.onTpiData(function(e){_i_("50d:e1cdb1d1"),u.track("PPXGSCZRDbfHGFbDZSIPfLHXT"),u.stage("PPXGSCZRDbfHGFbDZSIPfLHXT",4),(new i).render(e),_r_()}),_r_()});